<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Khảo sát nhu cầu lắp đặt điện năng lượng mặt trời - HC Eco System" />
    <title>Khảo sát điện mặt trời - HC Eco System</title>
        
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter with Vietnamese subset -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap&subset=vietnamese" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="../assets/img/logo.jpg" />

    <!-- Slideshow CSS -->
    <link rel="stylesheet" href="../assets/css/slideshow.css" />
    
    <!-- Modern CSS Design -->
    <style>
        :root {
            --color-primary: #00C851;
            --color-secondary: #00E676;
            --color-accent: #69F0AE;
            --color-accent-light: #B9F6CA;
            --color-bg-light: #F1F8E9;
            --color-text-dark: #1B5E20;
            --color-text-light: #ffffff;
            --color-card-bg: #ffffff;
            --color-border: #C8E6C9;
            --color-shadow: rgba(0, 200, 81, 0.15);
            --color-shadow-strong: rgba(0, 200, 81, 0.25);
            --gradient-primary: linear-gradient(135deg, #00C851 0%, #00E676 50%, #69F0AE 100%);
            --gradient-card: linear-gradient(145deg, #ffffff 0%, #F1F8E9 100%);
            --gradient-bg: linear-gradient(135deg, #E8F5E8 0%, #F1F8E9 25%, #ffffff 50%, #F1F8E9 75%, #E8F5E8 100%);
            --gradient-hero: linear-gradient(135deg, rgba(0,200,81,0.1) 0%, rgba(105,240,174,0.1) 50%, rgba(185,246,202,0.1) 100%);
            --border-radius: 20px;
            --border-radius-sm: 12px;
            --border-radius-lg: 24px;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fffe 0%, #e8f5e8 100%);
            color: var(--color-text-dark);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        /* Dark Mode styles */
        body[data-theme="dark"] {
            background-color: #12181B;
            color: var(--color-text-light);
        }
        body[data-theme="dark"] .dark\:bg-gray-900 { background-color: #1a202c; }
        body[data-theme="dark"] .dark\:bg-gray-800 { background-color: #2d3748; }
        body[data-theme="dark"] .dark\:text-gray-100 { color: #f7fafc; }
        body[data-theme="dark"] .dark\:text-gray-300 { color: #d1d5db; }
        body[data-theme="dark"] .dark\:border-gray-700 { border-color: #4a5568; }

        .theme-toggle__icon { display: none; }
        body:not([data-theme="dark"]) .theme-toggle__icon--sun { display: block; }
        body[data-theme="dark"] .theme-toggle__icon--moon { display: block; }

        /* Styles for dynamically injected auth buttons */
        .auth-btn {
            padding: 0.6rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            transition: background-color 0.2s, color 0.2s;
            line-height: 1.25rem;
            text-decoration: none;
        }
        /* Login Button */
        .auth-btn--login {
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-800 */
        }
        .auth-btn--login:hover {
            background-color: #e5e7eb; /* gray-200 */
        }
        /* Register button, also used for logout by auth.js */
        .auth-btn--register {
            background-color: #16a34a; /* green-600 */
            color: white;
        }
        .auth-btn--register:hover {
             background-color: #15803d; /* green-700 */
        }
        /* Logged-in state: username and logout button */
        .auth-user-name {
            font-weight: 600;
            font-size: 0.875rem; /* 14px - smaller font */
            padding: 0.5rem 0.75rem; /* Reduced padding */
            white-space: nowrap;
            text-decoration: none;
            max-width: 120px; /* Limit width */
            overflow: hidden;
            text-overflow: ellipsis;
            display: inline-block;
        }
        /* Specifically target the logout button */
        .auth-user-name + .auth-btn--register { 
             background-color: #fee2e2; /* red-100 */
             color: #b91c1c; /* red-700 */
             font-size: 0.75rem; /* 12px - smaller font */
             padding: 0.5rem 0.75rem; /* Reduced padding */
             min-width: auto; /* Remove minimum width */
        }
         .auth-user-name + .auth-btn--register:hover {
             background-color: #fecaca; /* red-200 */
        }

        /* Dark mode styles for auth buttons */
        body[data-theme="dark"] .auth-btn--login {
            background-color: #374151; /* gray-700 */
            color: #f9fafb; /* gray-100 */
        }
        body[data-theme="dark"] .auth-btn--login:hover {
            background-color: #4b5563; /* gray-600 */
        }
        body[data-theme="dark"] .auth-user-name {
            color: #d1d5db; /* gray-300 */
        }
        body[data-theme="dark"] .auth-user-name + .auth-btn--register { /* Dark mode Logout button */
             background-color: #450a0a; /* red-900 */
             color: #fca5a5; /* red-400 */
        }
        body[data-theme="dark"] .auth-user-name + .auth-btn--register:hover {
             background-color: #7f1d1d; /* red-800 */
        }
        body {
            background: var(--gradient-bg);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Animated background with solar panels */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 15% 20%, rgba(0,200,81,0.08) 0%, transparent 40%),
                radial-gradient(circle at 85% 80%, rgba(105,240,174,0.06) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(185,246,202,0.04) 0%, transparent 60%),
                linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.05) 75%),
                linear-gradient(-45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.05) 75%);
            background-size: 800px 800px, 600px 600px, 1000px 1000px, 60px 60px, 60px 60px;
            animation: backgroundMove 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes backgroundMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-10px, -5px) rotate(0.5deg); }
            50% { transform: translate(5px, -10px) rotate(-0.5deg); }
            75% { transform: translate(-5px, 5px) rotate(0.3deg); }
        }
        
        /* Floating solar panel icons */
        body::after {
            content: '☀️';
            position: fixed;
            font-size: 2rem;
            color: rgba(255, 193, 7, 0.3);
            animation: float 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.6; }
        }
        .survey-container {
            max-width: 1400px;
            margin: var(--spacing-lg) auto;
            padding: 0 var(--spacing-lg);
            position: relative;
            z-index: 1;
        }
        
        /* Modern Form Layout */
        .survey-form-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        
        .form-column {
            background: var(--gradient-card);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 20px 40px var(--color-shadow), 0 8px 16px rgba(0,0,0,0.05);
            border: 1px solid var(--color-border);
            transition: all 0.3s ease;
        }
        
        .form-column:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px var(--color-shadow), 0 12px 24px rgba(0,0,0,0.08);
        }
        
        /* Unified Results Layout */
        .results-wrapper {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 20px 40px var(--color-shadow), 0 8px 16px rgba(0,0,0,0.05);
            border: 1px solid var(--color-border);
            margin-bottom: var(--spacing-xl);
        }
        
        .results-grid {
            display: block;
            width: 100%;
        }
        
        .results-column {
            width: 100%;
        }
        
        .survey-card {
            background: transparent;
            padding: 0;
            box-shadow: none;
            margin-bottom: 0;
            border: none;
        }
        
        .survey-card {
            background: var(--gradient-hero);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: 0 25px 50px var(--color-shadow-strong), 0 12px 24px rgba(0,0,0,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .survey-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(0,200,81,0.1), transparent, rgba(105,240,174,0.1), transparent);
            animation: rotate 10s linear infinite;
            z-index: -1;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .survey-card h2 {
            color: var(--color-text-dark);
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
            font-weight: 900;
            text-align: center;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }
        
        .form-group {
            margin-bottom: 0.9rem;
        }
        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.6rem;
            color: var(--color-text-dark);
            font-size: 1rem;
            position: relative;
        }
        
        .form-group label::before {
            content: '';
            position: absolute;
            left: -1.2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            background: var(--gradient-primary);
            border-radius: 50%;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            font-weight: 500;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 6px var(--color-shadow), 0 8px 25px var(--color-shadow-strong);
            transform: translateY(-3px);
            background: rgba(255,255,255,1);
        }
        
        .form-group input:hover,
        .form-group select:hover {
            border-color: var(--color-secondary);
            transform: translateY(-1px);
        }

        .radio-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 1rem 1.2rem;
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            flex: 1;
            min-width: 120px;
            position: relative;
            overflow: hidden;
        }
        
        .radio-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: all 0.4s ease;
            z-index: -1;
        }
        
        .radio-option:hover {
            border-color: var(--color-primary);
            background: rgba(0,200,81,0.05);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--color-shadow-strong);
        }
        
        .radio-option:hover::before {
            left: 0;
            opacity: 0.1;
        }
        
        .radio-option.selected {
            border-color: var(--color-primary);
            background: rgba(0,200,81,0.1);
            box-shadow: 0 8px 25px var(--color-shadow-strong);
        }
        .radio-option input {
            width: 20px;
            height: 20px;
            margin: 0;
            cursor: pointer;
            accent-color: #3FA34D;
        }
        .radio-option span {
            font-weight: 600;
            color: #2d3748;
        }
        .btn-calculate {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem 2.5rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 12px 30px var(--color-shadow-strong);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-calculate::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }
        .btn-calculate:hover::before {
            left: 100%;
        }
        .btn-calculate:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px var(--color-shadow-strong);
        }
        .btn-calculate:active {
            transform: translateY(-1px);
        }
        .results {
            display: none;
        }
        .results.show {
            display: block;
            animation: fadeInUp 0.6s ease-out;
        }
        
        /* Placeholder khi chưa có kết quả */
        .results-placeholder {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 3rem 2rem;
            text-align: center;
            border: 2px dashed #cbd5e0;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
        }
        .results.show + .results-placeholder {
            display: none;
        }
        .results-placeholder-icon {
            font-size: 4rem;
            opacity: 0.3;
        }
        .results-placeholder-text {
            color: #718096;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .results-placeholder-subtext {
            color: #a0aec0;
            font-size: 0.95rem;
        }
        
        /* Modern Table Design */
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--color-card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 25px var(--color-shadow), 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: var(--spacing-md);
            border: 1px solid var(--color-border);
        }
        
        .excel-table thead {
            background: var(--gradient-primary);
            color: white;
        }
        
        .excel-table th {
            padding: var(--spacing-md);
            text-align: left;
            font-weight: 700;
            font-size: 0.95rem;
            border-right: 1px solid rgba(255,255,255,0.2);
            letter-spacing: 0.5px;
        }
        
        .excel-table th:last-child {
            border-right: none;
        }
        
        .excel-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
            border-right: 1px solid var(--color-border);
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .excel-table td:last-child {
            border-right: none;
        }
        
        .excel-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .excel-table tbody tr:hover {
            background: rgba(0,200,81,0.08);
            transform: scale(1.02);
            box-shadow: 0 8px 25px var(--color-shadow);
        }
        .excel-table .label-col {
            font-weight: 600;
            color: #4a5568;
            width: 30%;
        }
        .excel-table .value-col {
            color: #2d3748;
        }
        .excel-table .price-col {
            font-weight: 700;
            color: var(--color-primary);
            text-align: right;
        }
        .excel-table .product-image-cell {
            width: 80px;
            text-align: center;
        }
        .excel-table .product-image-small {
            width: 70px;
            height: 70px;
            object-fit: contain;
            background: #f7fafc;
            border-radius: 8px;
            padding: 0.5rem;
        }
        .section-header {
            background: var(--gradient-hero);
            backdrop-filter: blur(20px);
            padding: 1.5rem 2rem;
            margin: 2rem 0 1.5rem 0;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 15px 35px var(--color-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 0 6px 6px 0;
        }
        
        .section-header h3 {
            color: var(--color-text-dark);
            margin: 0;
            font-size: 1.4rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            position: relative;
            z-index: 1;
        }
        .total-summary {
            background: var(--gradient-primary);
            color: white;
            padding: 2.5rem;
            border-radius: var(--border-radius-lg);
            text-align: center;
            box-shadow: 0 25px 50px var(--color-shadow-strong);
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .total-summary::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent, rgba(255,255,255,0.05), transparent);
            animation: rotate 15s linear infinite;
            z-index: 0;
        }
        .total-summary h3 {
            margin: 0 0 1.5rem 0;
            font-size: 1.8rem;
            font-weight: 900;
            position: relative;
            z-index: 1;
        }
        .total-summary .total-price {
            font-size: 3rem;
            font-weight: 900;
            margin: 1.5rem 0;
            text-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        .total-summary .note {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 1rem;
        }
        
        /* New Summary Styles */
        .summary-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .summary-icon {
            font-size: 2.5rem;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .total-price-section {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.15);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
        }
        
        .price-label {
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .summary-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius-sm);
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            background: rgba(255,255,255,0.2);
        }
        
        .summary-card:hover::before {
            opacity: 1;
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        
        .card-content {
            position: relative;
            z-index: 1;
        }
        
        .card-label {
            font-size: 0.9rem;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .card-value {
            font-size: 1.2rem;
            font-weight: 800;
            color: white;
        }
        
        .summary-notes {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.3);
        }
        
        .note-item {
            font-size: 0.85rem;
            opacity: 0.8;
            text-align: center;
            padding: 0.5rem;
            background: rgba(255,255,255,0.1);
            border-radius: var(--border-radius-sm);
            backdrop-filter: blur(5px);
        }
        
        @media (max-width: 768px) {
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .summary-card {
                padding: 1rem;
            }
            
            .card-icon {
                font-size: 2rem;
                margin-bottom: 0.8rem;
            }
            
            .card-value {
                font-size: 1rem;
            }
            
            .total-price {
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .summary-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .summary-header {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .summary-icon {
                font-size: 2rem;
            }
        }
        
        /* Compact Battery Selection */
        .battery-compact {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .battery-compact-item {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        .battery-compact-item:hover {
            border-color: #3FA34D;
            box-shadow: 0 4px 15px rgba(63,163,77,0.15);
        }
        .battery-compact-item.selected {
            border: 3px solid #3FA34D;
            background: rgba(63,163,77,0.08);
        }
        .battery-compact-item label {
            display: flex;
            gap: 1rem;
            cursor: pointer;
            margin: 0;
            align-items: center;
        }
        .battery-compact-item input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #3FA34D;
        }
        .battery-compact-info {
            flex: 1;
        }
        .battery-compact-name {
            font-weight: 700;
            color: #2d3748;
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
        }
        .battery-compact-details {
            font-size: 0.85rem;
            color: #4a5568;
        }
        .battery-compact-price {
            font-size: 1.1rem;
            font-weight: 800;
            color: #3FA34D;
            margin-top: 0.3rem;
        }
        .result-section {
            background: transparent;
            padding: 0;
            border-radius: 0;
            margin-bottom: 1.5rem;
            box-shadow: none;
            border: none;
            transition: none;
        }
        .result-section:hover {
            transform: none;
            box-shadow: none;
        }
        .result-section h3 {
            display: none;
        }
        .result-item {
            display: none;
        }
        .result-label {
            display: none;
        }
        .result-value {
            display: none;
        }
        .total-section {
            display: none;
        }
        .total-section h3 {
            display: block;
        }
        .product-image-wrapper {
            display: none;
        }
        .product-image {
            display: none;
        }
        .product-name {
            display: none;
        }
        
        /* Style cho nút Lưu Báo Giá */
        #saveSurveyBtn:hover {
            background: #2d5016 !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(63, 163, 77, 0.4);
        }
        #saveSurveyBtn:active {
            transform: translateY(0);
        }
        
        /* Floating Action Button for Cart */
        .cart-fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #56ab2f, #3FA34D);
            color: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(63,163,77,0.4);
            cursor: pointer;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 999;
            text-decoration: none;
        }

        .cart-fab:hover {
            transform: translateY(-5px) scale(1.15);
            box-shadow: 0 15px 40px rgba(63,163,77,0.5);
        }

        .cart-fab .fab-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #a8e063, #ff6b6b);
            color: white;
            border-radius: 50%;
            width: 26px;
            height: 26px;
            font-size: 13px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .survey-container {
                padding: 0 1rem;
                margin: 2rem auto;
            }
            .survey-form-wrapper {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            .results-grid {
                display: block;
                width: 100%;
            }
            .results-wrapper {
                margin-right: 0;
                padding-bottom: 150px;
            }
            .cart-fab {
                bottom: 75px;
                right: 20px;
                width: 58px;
                height: 58px;
                font-size: 1.4rem;
            }
            .survey-card h2 {
                font-size: 1.4rem;
            }
            .result-section {
                padding: 1.8rem;
            }
            .result-section h3 {
                font-size: 1.3rem;
            }
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            .result-value {
                text-align: left;
            }
            .total-price {
                font-size: 2.2rem;
            }
            .product-image-wrapper {
                flex-direction: column;
                text-align: center;
            }
            .product-image {
                width: 90px;
                height: 90px;
            }
            .radio-option {
                min-width: 100%;
            }
        }
        
        /* Floating Action Button for Cart */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }
        .custom-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            position: relative;
        }
        .modal-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }
        .modal-icon.success {
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
            box-shadow: 0 10px 30px rgba(168, 224, 99, 0.4);
        }
        .modal-icon.error {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }
        .modal-icon.warning {
            background: linear-gradient(135deg, #f9ca24 0%, #f39c12 100%);
            box-shadow: 0 10px 30px rgba(249, 202, 36, 0.4);
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            text-align: center;
        }
        .modal-message {
            font-size: 1.05rem;
            color: #4a5568;
            line-height: 1.6;
            text-align: center;
            margin-bottom: 2rem;
        }
        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        .modal-btn {
            padding: 0.8rem 2rem;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 1rem;
        }
        .modal-btn.primary {
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3);
        }
        .modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(86, 171, 47, 0.4);
        }
        .modal-btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        .modal-btn.secondary:hover {
            background: #cbd5e0;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Currency input wrapper */
        .currency-input-wrapper {
            position: relative;
            display: block;
            width: 100%;
        }
        .currency-input-wrapper input {
            width: 100%;
            padding-right: 2.5rem; /* Space for currency symbol */
        }
        .currency-symbol {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #718096;
            font-weight: 600;
            font-size: 1rem;
            user-select: none;
        }
        /* Slideshow enhancements */
        body {
            background-color: transparent !important;
            background: transparent !important;
        }

        /* Make content sections slightly transparent to show slideshow */
        .bg-gray-50 {
            background-color: rgba(249, 250, 251, 0.95) !important;
        }

        body[data-theme="dark"] .bg-gray-900 {
            background-color: rgba(17, 24, 39, 0.95) !important;
        }

        /* Hero sections with glass effect */
        #hero-section, .hero-gradient {
            backdrop-filter: blur(10px);
        }

        /* Sections with glassmorphism */
        section {
            position: relative;
        }

        section:not(#hero-section):not(.hero-gradient) {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(8px);
        }

        body[data-theme="dark"] section:not(#hero-section):not(.hero-gradient) {
            background: rgba(26, 32, 44, 0.8);
        }

        /* Improve text readability on slideshow */
        main {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900" data-page="survey">

    <!-- Background Slideshow -->
    <div id="slideshow-background" class="slideshow-background"></div>
    
    <!-- Header -->
    <header id="header" class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200 dark:border-gray-700 transition-all duration-300">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-20">
                <!-- Branding -->
                <a href="../index.html" class="flex items-center gap-3">
                    <img class="h-12 w-12 rounded-lg object-cover" src="../assets/img/logo.jpg" alt="Logo HC Eco System" />
                    <div>
                        <div class="font-bold text-lg text-gray-800 dark:text-white">HC<span class="text-green-600">ECO SYSTEM</span></div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 hidden sm:block">Giải pháp bền vững cho năng lượng tương lai</p>
                    </div>
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex items-center bg-gray-100 dark:bg-gray-800 p-1 rounded-full">
                    <a href="gioi-thieu.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-700 rounded-full transition-all duration-200">Giới thiệu</a>
                    <a href="pricing.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-700 rounded-full transition-all duration-200">Bảng giá</a>
                    <a href="du-an.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-700 rounded-full transition-all duration-200">Dự án</a>
                    <a href="tin-tuc.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-700 rounded-full transition-all duration-200">Tin tức</a>
                    <a href="https://c-homebuild.com/" target="_blank" rel="noopener noreferrer" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-700 rounded-full transition-all duration-200">Xây dựng</a>
                    <a href="lien-he.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-700 rounded-full transition-all duration-200">Liên hệ</a>
                </nav>

                <!-- Actions -->
                <div class="flex items-center gap-2">
                    <button class="theme-toggle h-10 w-10 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700" type="button" data-theme-toggle aria-label="Chuyển giao diện">
                        <svg class="theme-toggle__icon theme-toggle__icon--sun w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg class="theme-toggle__icon theme-toggle__icon--moon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                    <a class="cta hidden sm:inline-block bg-green-600 text-white font-semibold px-5 py-2.5 rounded-full hover:bg-green-700 transition-all duration-300 shadow-lg shadow-green-500/20" href="khao-sat-dien-mat-troi.html">Nhận tư vấn</a>
                    
                    <!-- Auth buttons will appear here, integrated into the header -->
                    <div id="auth-buttons" class="hidden sm:flex items-center gap-2">
                        <!-- Dynamically populated by auth.js -->
                    </div>

                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" class="lg:hidden h-10 w-10 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800">
                         <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Navigation -->
        <div id="mobile-menu" class="lg:hidden hidden bg-white dark:bg-gray-800 border-t dark:border-gray-700 p-4">
            <nav class="flex flex-col gap-2">
                <a href="gioi-thieu.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Giới thiệu</a>
                <a href="pricing.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Bảng giá</a>
                <a href="du-an.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Dự án</a>
                <a href="tin-tuc.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Tin tức</a>
                <a href="https://c-homebuild.com/" target="_blank" rel="noopener noreferrer" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Xây dựng</a>
                <a href="lien-he.html" class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Liên hệ</a>
            </nav>
        </div>
    </header>

    <!-- Floating Cart Button -->
    <a href="gio-hang.html" id="cart-fab" class="fixed bottom-6 right-6 z-50 h-14 w-14 bg-green-600 text-white rounded-2xl flex items-center justify-center shadow-lg hover:bg-green-700 transition-all duration-300">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
        <span id="fab-cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-6 h-6 rounded-full flex items-center justify-center border-2 border-white dark:border-gray-800" style="display: none;">0</span>
    </a>

    <!-- Main Content -->

    <main>
        <div class="survey-container">
            <div class="survey-card">
                <h2>📋 Khảo Sát Chi Tiết Hệ Thống Điện Mặt Trời</h2>
            </div>
            
            <!-- Form nhập liệu chia 2 cột như quyển vở -->
            <form id="surveyForm">
                <div class="survey-form-wrapper">
                    <!-- Cột trái của form -->
                    <div class="form-column">
                        <!-- Thông tin cơ bản -->
                        <div class="form-group">
                            <label>Họ và Tên *</label>
                            <input type="text" name="fullname" required placeholder="Nguyễn Văn A" />
                        </div>

                        <div class="form-group">
                            <label>Số Điện Thoại *</label>
                            <input type="tel" name="phone" required placeholder="0988919868" />
                        </div>

                        <div class="form-group">
                            <label>Khu Vực *</label>
                            <select name="region" required>
                                <option value="">-- Chọn khu vực --</option>
                                <option value="mien-bac">Miền Bắc (4,4 giờ nắng/ngày)</option>
                                <option value="mien-trung">Miền Trung (6,3 giờ nắng/ngày)</option>
                                <option value="mien-nam">Miền Nam (6,3 giờ nắng/ngày)</option>
                            </select>
                        </div>

                        <!-- Loại điện -->
                        <div class="form-group">
                            <label>Loại Điện *</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="phase" value="1" required />
                                    <span>1 Pha</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="phase" value="3" />
                                    <span>3 Pha</span>
                                </label>
                            </div>
                        </div>

                        <!-- Loại tấm pin -->
                        <div class="form-group">
                            <label>Chọn Loại Tấm Pin *</label>
                            <select name="solarPanel" required>
                                <option value="">-- Chọn loại tấm pin --</option>
                                <option value="590" data-price="1800000" data-image="../assets/img/products/tam-pin-jinko-solar-590w-tiger-neo.jpg">Jinko Solar 590W Tiger Neo - 2,583m² / tấm pin</option>
                                <option value="630" data-price="1950000" data-image="../assets/img/products/tam-pin-jinko-solar-630w-tiger-neo.png">Jinko Solar 630W Tiger Neo - 2,702m² / tấm pin</option>
                            </select>
                        </div>

                        <!-- Loại pin -->
                        <div class="form-group">
                            <label>Chọn Loại Pin *</label>
                            <select name="batteryType" required>
                                <option value="">-- Chọn loại pin --</option>
                                <option value="acornex" data-price="0" data-image="../assets/img/products/pin-luu-tru-acornex.jpg">PIN LƯU TRỮ A-CORNEX - 16.3kWh (315Ah @ 52V)</option>
                                <option value="byd" data-price="0" data-image="../assets/img/products/pin-luu-tru-byd.jpg">PIN LƯU TRỮ BYD - 8.8kWh @ 51.2V (173Ah)</option>
                            </select>
                        </div>

                    </div>

                    <!-- Cột phải của form -->
                    <div class="form-column">
                        <!-- Tiền điện hàng tháng -->
                        <div class="form-group">
                            <label>Tiền Điện Trung Bình/Tháng (VNĐ) *</label>
                            <div class="currency-input-wrapper">
                                <input type="text" id="monthlyBillInput" name="monthlyBill" required placeholder="VD: 1.500.000" />
                                <span class="currency-symbol">đ</span>
                            </div>
                        </div>
                        
                        <!-- Bảng giá điện EVN -->
                        <div class="form-group">
                            <div style="background: linear-gradient(135deg, rgba(63,163,77,0.08) 0%, rgba(168,224,99,0.08) 100%); border-radius: 12px; padding: 1rem; border: 2px solid rgba(63,163,77,0.2);">
                                <div style="display: flex; flex-direction: column; gap: 0.3rem; margin-bottom: 0.8rem;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.2rem;">⚡</span>
                                    <strong style="color: #3FA34D; font-size: 0.95rem;">Bảng Giá Điện Sinh Hoạt EVN (Có VAT 8%)</strong>
                                </div>
                                    <div style="font-size: 0.75rem; color: #718096; font-style: italic; padding-left: 1.7rem;">
                                        Áp dụng từ 10/5/2025
                                    </div>
                                </div>
                                <table style="width: 100%; font-size: 0.82rem; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                                    <thead>
                                        <tr style="background: rgba(63,163,77,0.1);">
                                            <th style="padding: 0.5rem; text-align: left; color: #2d3748; font-weight: 600; border-bottom: 2px solid rgba(63,163,77,0.2);">Bậc</th>
                                            <th style="padding: 0.5rem; text-align: right; color: #2d3748; font-weight: 600; border-bottom: 2px solid rgba(63,163,77,0.2);">Chưa VAT</th>
                                            <th style="padding: 0.5rem; text-align: right; color: #1E5631; font-weight: 700; border-bottom: 2px solid rgba(63,163,77,0.2);">Có VAT 8%</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid rgba(226,232,240,0.5);">
                                            <td style="padding: 0.4rem 0.5rem; color: #4a5568;">Bậc 1: 0-50 kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; color: #718096;">1.984đ/kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; font-weight: 600; color: #3FA34D;">2.143đ/kWh</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid rgba(226,232,240,0.5);">
                                            <td style="padding: 0.4rem 0.5rem; color: #4a5568;">Bậc 2: 51-100 kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; color: #718096;">2.050đ/kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; font-weight: 600; color: #3FA34D;">2.214đ/kWh</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid rgba(226,232,240,0.5);">
                                            <td style="padding: 0.4rem 0.5rem; color: #4a5568;">Bậc 3: 101-200 kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; color: #718096;">2.380đ/kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; font-weight: 600; color: #3FA34D;">2.570đ/kWh</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid rgba(226,232,240,0.5);">
                                            <td style="padding: 0.4rem 0.5rem; color: #4a5568;">Bậc 4: 201-300 kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; color: #718096;">2.930đ/kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; font-weight: 600; color: #3FA34D;">3.164đ/kWh</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid rgba(226,232,240,0.5);">
                                            <td style="padding: 0.4rem 0.5rem; color: #4a5568;">Bậc 5: 301-400 kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; color: #718096;">3.270đ/kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; font-weight: 600; color: #3FA34D;">3.532đ/kWh</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 0.4rem 0.5rem; color: #4a5568;">Bậc 6: Từ 401 kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; color: #718096;">3.460đ/kWh</td>
                                            <td style="padding: 0.4rem 0.5rem; text-align: right; font-weight: 600; color: #3FA34D;">3.737đ/kWh</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div style="margin-top: 0.8rem; padding-top: 0.6rem; border-top: 1px solid rgba(226,232,240,0.5);">
                                    <div style="font-size: 0.8rem; color: #718096; display: flex; align-items: start; gap: 0.3rem;">
                                        <span>💡</span>
                                        <span>Hệ thống sẽ tự động tính toán mức tiêu thụ kWh dựa trên số tiền điện bạn nhập (sử dụng giá có VAT 8% - áp dụng từ 10/5/2025)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thời gian sử dụng -->
                        <div class="form-group">
                            <label>Thời Gian Sử Dụng Điện Chủ Yếu *</label>
                            <select name="usageTime" required>
                                <option value="">-- Chọn thời gian --</option>
                                <option value="day">Ban ngày nhiều (pin = 1/3 điện tạo ra)</option>
                                <option value="balanced">Cả ngày đều (pin = 1/2 điện tạo ra)</option>
                                <option value="night">Ban đêm nhiều (pin = 3/5 điện tạo ra)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Nút tính toán và xem lịch sử -->
                <div style="text-align: center; margin-top: 1.5rem;">
                    <button type="submit" class="btn-calculate">🔍 Tính Toán Báo Giá</button>
                    <div style="margin-top: 1rem;">
                        <a href="survey_history.html" style="display: inline-block; background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%); color: white; padding: 0.8rem 1.8rem; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 0.9rem; box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(86, 171, 47, 0.4)';" onmouseout="this.style.transform=''; this.style.boxShadow='0 4px 15px rgba(86, 171, 47, 0.3)';">
                            📋 Xem Lịch Sử Khảo Sát
                        </a>
                    </div>
                </div>
            </form>

            <!-- Kết quả - cũng chia 2 cột bên dưới -->
            <div class="results-wrapper">
                <div id="results" class="results">
                    <!-- Kết quả sẽ được hiển thị ở đây dạng 2 cột -->
                </div>
                <div class="results-placeholder">
                    <div class="results-placeholder-icon">📊</div>
                    <div class="results-placeholder-text">Kết quả báo giá sẽ hiển thị tại đây</div>
                    <div class="results-placeholder-subtext">Vui lòng điền đầy đủ thông tin và nhấn "Tính Toán Báo Giá"</div>
                </div>
            </div>
        </div>

        <!-- Tại Sao Chọn Năng Lượng Mặt Trời - NEW SECTION -->
        <section class="py-16 bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-900 dark:to-gray-800">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold text-gray-800 dark:text-white mb-4">
                        ☀️ Tại Sao Nên Chọn Năng Lượng Mặt Trời?
                    </h2>
                    <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                        Tiết kiệm chi phí, bảo vệ môi trường, đầu tư sinh lời bền vững
                    </p>
                </div>

                <!-- Video Demo -->
                <div class="max-w-4xl mx-auto mb-12">
                    <div class="rounded-2xl overflow-hidden shadow-2xl bg-gray-900">
                        <video controls class="w-full" poster="../Photo/residential-solar-home.png">
                            <source src="../Video/Prompt 5.mp4" type="video/mp4">
                            Trình duyệt của bạn không hỗ trợ video.
                        </video>
                        <div class="p-4 bg-gradient-to-r from-green-800 to-blue-800">
                            <p class="text-white text-center">
                                🔌 Xem hệ thống hoạt động: Công tắc bật → Thiết bị chạy → Năng lượng từ tấm pin
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 4 Benefits -->
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                    <!-- Benefit 1 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300">
                        <div class="h-48 overflow-hidden">
                            <img src="../Photo/benefits-roi.png" alt="Tiết kiệm" class="w-full h-full object-cover" />
                        </div>
                        <div class="p-6">
                            <div class="text-3xl mb-3">💰</div>
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Tiết Kiệm Chi Phí</h3>
                            <p class="text-gray-600 dark:text-gray-300 text-sm">
                                Giảm đến 80% hóa đơn tiền điện mỗi tháng. Hoàn vốn sau 5-7 năm.
                            </p>
                            <div class="mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <p class="text-green-700 dark:text-green-400 font-semibold text-sm">
                                    ⚡ Tiết kiệm: 3-8 triệu/tháng
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Benefit 2 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300">
                        <div class="h-48 overflow-hidden">
                            <img src="../Photo/Solar Energy System in a Green Urban Landscape.png" alt="Thân thiện môi trường" class="w-full h-full object-cover" />
                        </div>
                        <div class="p-6">
                            <div class="text-3xl mb-3">🌱</div>
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Thân Thiện Môi Trường</h3>
                            <p class="text-gray-600 dark:text-gray-300 text-sm">
                                Giảm phát thải CO2, không gây ô nhiễm, năng lượng sạch và tái tạo.
                            </p>
                            <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <p class="text-blue-700 dark:text-blue-400 font-semibold text-sm">
                                    🌍 Giảm 2-4 tấn CO2/năm
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Benefit 3 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300">
                        <div class="h-48 overflow-hidden">
                            <img src="../Photo/solar-panels-sunset.png" alt="Bền vững" class="w-full h-full object-cover" />
                        </div>
                        <div class="p-6">
                            <div class="text-3xl mb-3">🔋</div>
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Bền Vững Lâu Dài</h3>
                            <p class="text-gray-600 dark:text-gray-300 text-sm">
                                Tuổi thọ 25-30 năm, bảo hành 10 năm. Ít bảo trì, hoạt động ổn định.
                            </p>
                            <div class="mt-4 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <p class="text-purple-700 dark:text-purple-400 font-semibold text-sm">
                                    ⏱️ Tuổi thọ: 25-30 năm
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Benefit 4 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300">
                        <div class="h-48 overflow-hidden">
                            <img src="../Photo/modern-solar-panels.jpg" alt="Công nghệ hiện đại" class="w-full h-full object-cover" />
                        </div>
                        <div class="p-6">
                            <div class="text-3xl mb-3">🚀</div>
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Công Nghệ Hiện Đại</h3>
                            <p class="text-gray-600 dark:text-gray-300 text-sm">
                                Pin hiệu suất cao 590-630W, inverter thông minh, giám sát qua app.
                            </p>
                            <div class="mt-4 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <p class="text-orange-700 dark:text-orange-400 font-semibold text-sm">
                                    📱 Giám sát 24/7 qua app
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Case Study - Câu Chuyện Khách Hàng - NEW SECTION -->
        <section class="py-16 bg-white dark:bg-gray-900">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold text-gray-800 dark:text-white mb-4">
                        🏠 Câu Chuyện Thành Công
                    </h2>
                    <p class="text-lg text-gray-600 dark:text-gray-300">
                        Gia đình anh Minh - Tiết kiệm 8 triệu đồng/tháng
                    </p>
                </div>

                <div class="max-w-6xl mx-auto">
                    <div class="grid lg:grid-cols-2 gap-8 items-center">
                        <!-- Video -->
                        <div>
                            <div class="rounded-2xl overflow-hidden shadow-2xl bg-gray-900">
                                <video controls class="w-full" poster="../Photo/Family Enjoying a Home with Solar Power in Vietnam.png">
                                    <source src="../Video/Prompt 9.mp4" type="video/mp4">
                                    Trình duyệt của bạn không hỗ trợ video.
                                </video>
                                <div class="p-4 bg-gray-800">
                                    <p class="text-gray-300 text-sm text-center">
                                        🎬 Gia đình anh Minh vui vẻ sinh hoạt với năng lượng mặt trời
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="space-y-6">
                            <div class="bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-800 dark:to-gray-800 p-8 rounded-xl shadow-lg">
                                <div class="flex items-center gap-4 mb-6">
                                    <img src="../Photo/residential-solar-home.png" alt="Nhà anh Minh" class="w-20 h-20 rounded-full object-cover border-4 border-white" />
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800 dark:text-white">Anh Nguyễn Văn Minh</h3>
                                        <p class="text-gray-600 dark:text-gray-300">Biệt thự Q7, TP.HCM</p>
                                        <div class="flex gap-1 mt-1">
                                            <span class="text-yellow-500 text-xl">★★★★★</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-4">
                                    <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Hệ thống lắp đặt:</p>
                                        <p class="font-bold text-gray-800 dark:text-white">15 kW - 24 tấm pin 630W</p>
                                    </div>

                                    <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Tiền điện trước:</p>
                                        <p class="font-bold text-red-600 dark:text-red-400 text-xl">12 triệu/tháng</p>
                                    </div>

                                    <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Tiền điện sau:</p>
                                        <p class="font-bold text-green-600 dark:text-green-400 text-xl">4 triệu/tháng</p>
                                    </div>

                                    <div class="bg-gradient-to-r from-green-600 to-blue-600 p-4 rounded-lg text-white">
                                        <p class="text-sm mb-1">💰 Tiết kiệm mỗi tháng:</p>
                                        <p class="font-bold text-2xl">8.000.000 VNĐ</p>
                                        <p class="text-xs mt-2 opacity-90">= 96 triệu/năm | Hoàn vốn sau 6 năm</p>
                                    </div>
                                </div>

                                <blockquote class="mt-6 border-l-4 border-green-600 pl-4 italic text-gray-700 dark:text-gray-300">
                                    "Quyết định lắp pin mặt trời là một trong những quyết định tốt nhất của gia đình tôi. Tiết kiệm được rất nhiều tiền điện hàng tháng, đồng thời góp phần bảo vệ môi trường. Đội ngũ HC ECO SYSTEM rất chuyên nghiệp!"
                                </blockquote>

                                <div class="mt-6 text-center">
                                    <a href="gioi-thieu.html" class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-full font-semibold shadow-lg transition-all duration-300">
                                        Xem Thêm Câu Chuyện Khách Hàng
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    
    <!-- Footer -->
    <footer id="site-footer" class="bg-gray-800 dark:bg-black text-gray-300">
        <div class="container mx-auto px-4 py-12">
            <div class="grid lg:grid-cols-3 md:grid-cols-2 gap-8">
                <!-- Branding & Copyright -->
                <div class="space-y-4">
                     <a href="../index.html" class="flex items-center gap-3">
                        <img class="h-12 w-12 rounded-lg object-cover" src="../assets/img/logo.jpg" alt="Logo HC Eco System" />
                        <div>
                            <div class="font-bold text-lg text-white">HC<span class="text-green-500">ECO SYSTEM</span></div>
                        </div>
                    </a>
                    <p class="text-sm text-gray-400">&copy; 2024 HC Eco System. Giữ vững cam kết năng lượng sạch cho mỗi nhà.</p>
                </div>

                <!-- Contact Info -->
                <div class="space-y-2">
                    <h4 class="font-semibold text-white">Thông tin liên hệ</h4>
                    <ul class="text-sm text-gray-400 space-y-1">
                        <li><strong>Hotline:</strong> 0988 919 868</li>
                        <li><strong>Zalo:</strong> 0988 919 868</li>
                        <li><strong>Email:</strong> hcecosystem@gmail.com</li>
                        <li><strong>Website:</strong> hcecosystem.vn</li>
                        <li><strong>Mã số thuế:</strong> 0123456789</li>
                        <li><strong>Địa chỉ Văn phòng:</strong><br>790 Ngô Quyền, Phường An Hải, Thành Phố Đà Nẵng</li>
                    </ul>
                </div>

                <!-- Policies -->
                <div class="space-y-2">
                     <h4 class="font-semibold text-white">Chính sách & Dịch vụ</h4>
                    <ul class="text-sm space-y-1">
                        <li><a href="tam-nhin-su-menh.html" class="text-gray-400 hover:text-white">Tầm Nhìn & Sứ Mệnh</a></li>
                        <li><a href="dieu-khoan-dieu-kien.html" class="text-gray-400 hover:text-white">Điều Khoản & Điều Kiện</a></li>
                        <li><a href="chinh-sach-doi-tra.html" class="text-gray-400 hover:text-white">Chính Sách Đổi Trả</a></li>
                        <li><a href="chinh-sach-bao-mat-thong-tin-ca-nhan.html" class="text-gray-400 hover:text-white">Chính Sách Bảo Mật Thông Tin Cá Nhân</a></li>
                        <li><a href="chinh-sach-bao-mat-thong-tin-thanh-toan.html" class="text-gray-400 hover:text-white">Chính Sách Bảo Mật Thông Tin Thanh Toán</a></li>
                        <li><a href="chinh-sach-bao-hanh.html" class="text-gray-400 hover:text-white">Chính Sách Bảo Hành</a></li>
                        <li><a href="tro-thanh-nha-phan-phoi.html" class="text-gray-400 hover:text-white">Trở Thành Nhà Phân Phối</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Scripts (IDs preserved) -->
    <script src="../assets/js/theme.js"></script>
    <script src="../assets/js/shopping-cart.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script>
        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const header = document.getElementById('header');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // Close menu when a link is clicked
        mobileMenu.addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                mobileMenu.classList.add('hidden');
            }
        });
        
        // Hide menu on scroll for better UX
        let lastScrollTop = 0;
        window.addEventListener("scroll", function(){ 
           var st = window.pageYOffset || document.documentElement.scrollTop; 
           if (st > lastScrollTop){
              // downscroll
              mobileMenu.classList.add('hidden');
           }
           lastScrollTop = st <= 0 ? 0 : st;
        }, false);


        // Bảng giá điện có VAT 8% (giá sau thuế) - Áp dụng từ 10/5/2025
        const electricityPrices = {
            1: { price: 2143, range: 50, name: 'Bậc 1 (0-50 kWh)' },      // 2.143đ/kWh
            2: { price: 2214, range: 50, name: 'Bậc 2 (51-100 kWh)' },    // 2.214đ/kWh
            3: { price: 2570, range: 100, name: 'Bậc 3 (101-200 kWh)' },  // 2.570đ/kWh
            4: { price: 3164, range: 100, name: 'Bậc 4 (201-300 kWh)' },  // 3.164đ/kWh
            5: { price: 3532, range: 100, name: 'Bậc 5 (301-400 kWh)' },  // 3.532đ/kWh
            6: { price: 3737, range: Infinity, name: 'Bậc 6 (Từ 401 kWh)' } // 3.737đ/kWh
        };

        // Danh sách inverter theo pha (Giá lắp đặt trọn gói - Từ trang sản phẩm)
        const invertersByPhase = {
            '1': [ // 1 Pha - LUXPOWER
                { name: "LUXPOWER 6K (1 Pha)", power: 6000, price: 21350000, warranty: "12 tháng", image: "../assets/img/products/hybrid-gen-lb-eu-6k.png", phase: "1" },
                { name: "LUXPOWER 8K (1 Pha)", power: 8000, price: 37250000, warranty: "12 tháng", image: "../assets/img/products/hybrid-gen-lb-eu-8k.png", phase: "1" },
                { name: "LUXPOWER 10K (1 Pha)", power: 10000, price: 39350000, warranty: "12 tháng", image: "../assets/img/products/hybrid-gen-lb-eu-10k.png", phase: "1" },
                { name: "LUXPOWER 12K (1 Pha)", power: 12000, price: 44350000, warranty: "12 tháng", image: "../assets/img/products/hybrid-gen-lb-eu-12k.png", phase: "1" }
            ],
            '3': [ // 3 Pha - LUXPOWER
                { name: "LUXPOWER 12K (3 Pha)", power: 12000, price: 48250000, warranty: "12 tháng", image: "../assets/img/products/hybrid-trip2-lb-3p-12k.png", phase: "3" },
                { name: "LUXPOWER 15K (3 Pha)", power: 15000, price: 51250000, warranty: "12 tháng", image: "../assets/img/products/hybrid-trip2-lb-3p-15k.png", phase: "3" }
            ]
        };

        // Danh sách pin lưu trữ (Giá lắp đặt trọn gói - Từ trang sản phẩm)
        const batteries = [
            { name: "PIN LƯU TRỮ A-CORNEX", capacity: 16.3, price: 25500000, warranty: "10 năm", image: "../assets/img/products/pin-luu-tru-acornex.jpg" },
            { name: "PIN LƯU TRỮ BYD", capacity: 8.8, price: 14500000, warranty: "10 năm", image: "../assets/img/products/pin-luu-tru-byd.jpg" },
            { name: "BYD Battery-Box Premium LVS", capacity: 15.36, price: 80000000, warranty: "10 năm", image: "../assets/img/products/cell-byd-173ah-lifepo4.png" },
            { name: "BYD Battery-Box Premium LVS", capacity: 20.48, price: 104600000, warranty: "10 năm", image: "../assets/img/products/cell-byd-173ah-lifepo4.png" }
        ];

        // Phụ kiện khác
        // Danh sách tủ điện theo pha (Giá lắp đặt trọn gói - Từ trang sản phẩm)
        const electricalCabinets = {
            '1': [ // 1 Pha
                { name: "Tủ Điện Hybrid 1 Pha 6kW", power: 6000, price: 1850000, image: "../assets/img/products/electrical-cabinet.jpg" },
                { name: "Tủ Điện Hybrid 1 Pha 8kW", power: 8000, price: 2100000, image: "../assets/img/products/electrical-cabinet.jpg" },
                { name: "Tủ Điện Hybrid 1 Pha 10kW", power: 10000, price: 2350000, image: "../assets/img/products/electrical-cabinet.jpg" },
                { name: "Tủ Điện Hybrid 1 Pha 12kW", power: 12000, price: 2600000, image: "../assets/img/products/electrical-cabinet.jpg" }
            ],
            '3': [ // 3 Pha
                { name: "Tủ Điện Hybrid 3 Pha 12kW", power: 12000, price: 2850000, image: "../assets/img/products/electrical-cabinet.jpg" },
                { name: "Tủ Điện Hybrid 3 Pha 15kW", power: 15000, price: 3100000, image: "../assets/img/products/electrical-cabinet.jpg" }
            ]
        };

        const accessories = [
            // 1. Tấm Pin Mặt Trời (đã tính riêng)
            // 2. Máy Biến Tần Hybrid (đã tính riêng)
            // 3. Pin Lưu Trữ LiFePO4 (đã tính riêng)
            // 4. Pin Lưu Trữ LiFePO4 BYD (đã tính riêng)
            // 5. Tủ Điện (sẽ được chọn động)
            { name: "Bách Z Mạ Kẽm", unit: "cái", price: 80000, quantity: 0, image: "../assets/img/products/bachz.png" },
            { name: "Kẹp Biên & Kẹp Giữa", unit: "bộ", price: 15000, quantity: 0, image: "../assets/img/products/kepbien-tamgiua.png" },
            { name: "Jack Cắm MC4 1500VDC", unit: "bộ", price: 50000, quantity: 0, image: "../assets/img/products/jackcam.png" },
            { name: "Dây Điện (AC/DC)", unit: "mét", price: 30000, quantity: 0, image: "../assets/img/products/daydien.png" },
            { name: "Công Thợ Lắp Đặt Trọn Gói", unit: "dự án", price: 6000000, quantity: 1, image: "🔧" },
            { name: "Vận Chuyển Đến Công Trình", unit: "chuyến", price: 1000000, quantity: 1, image: "🚛" }
        ];

        // Hàm tính kWh từ số tiền điện và trả về chi tiết từng bậc
        function calculateKwhFromBill(billAmount) {
            let remainingAmount = billAmount;
            let totalKwh = 0;
            const breakdown = []; // Lưu chi tiết từng bậc
            
            // Duyệt qua từng bậc thang
            for (let tier = 1; tier <= 6; tier++) {
                if (remainingAmount <= 0) break;
                
                const tierInfo = electricityPrices[tier];
                const maxKwh = tierInfo.range;
                const pricePerKwh = tierInfo.price;
                
                // Tính số kWh có thể dùng ở bậc này
                const possibleKwh = remainingAmount / pricePerKwh;
                const actualKwh = Math.min(maxKwh, possibleKwh);
                
                if (actualKwh > 0) {
                    const tierAmount = actualKwh * pricePerKwh;
                    
                    breakdown.push({
                        tier: tier,
                        name: tierInfo.name,
                        pricePerKwh: pricePerKwh,
                        kwh: actualKwh,
                        amount: tierAmount
                    });
                    
                    totalKwh += actualKwh;
                    remainingAmount -= tierAmount;
                }
            }
            
            return {
                totalKwh: Math.round(totalKwh * 10) / 10, // Làm tròn 1 chữ số thập phân
                breakdown: breakdown,
                totalAmount: billAmount
            };
        }

        // Hàm tính toán báo giá hệ thống điện mặt trời
        function calculateSolarSystem(formData) {
            const monthlyBill = parseInt(formData.monthlyBill.replace(/[^\d]/g, ''));
            const kwhCalculation = calculateKwhFromBill(monthlyBill);
            const monthlyKwh = kwhCalculation.totalKwh;
            
            // Lấy thông tin tấm pin từ option được chọn
            const solarPanelSelect = document.querySelector('select[name="solarPanel"]');
            const selectedOption = solarPanelSelect.options[solarPanelSelect.selectedIndex];
            const solarPanelWatt = parseInt(selectedOption.value);
            const solarPanelPrice = parseInt(selectedOption.getAttribute('data-price'));
            const solarPanelImage = selectedOption.getAttribute('data-image');
            
            // Điều chỉnh giờ nắng theo khu vực
            let peakSunHours = 4.4; // Mặc định
            if (formData.region === 'mien-bac') peakSunHours = 4.4;
            else if (formData.region === 'mien-trung') peakSunHours = 6.3;
            else if (formData.region === 'mien-nam') peakSunHours = 6.3;
            
            // Tính toán hệ thống
            const dailyKwh = monthlyKwh / 30;
            const systemSizeKw = Math.ceil(dailyKwh / peakSunHours);
            const systemSizeWatt = systemSizeKw * 1000;
            
            // Số lượng tấm pin cần thiết
            const panelCount = Math.ceil(systemSizeWatt / solarPanelWatt);
            
            // Tính diện tích mái cần thiết (mỗi tấm pin ~2.8m²)
            const roofArea = (panelCount * 2.8).toFixed(1);
            
            // Chọn inverter phù hợp theo pha đã chọn
            let selectedInverter;
            const availableInverters = invertersByPhase[formData.phase] || [];
            
            if (availableInverters.length > 0) {
                // Tìm inverter có công suất phù hợp (lớn hơn hoặc bằng hệ thống)
                selectedInverter = availableInverters.find(inv => inv.power >= systemSizeWatt) || availableInverters[availableInverters.length - 1];
            } else {
                // Fallback nếu không có inverter phù hợp
                selectedInverter = { name: "Không có biến tần phù hợp", power: 0, price: 0, warranty: "N/A", image: "", phase: formData.phase };
            }
            
            // Tính sản lượng điện thực tế
            const actualDailyKwh = (panelCount * solarPanelWatt * peakSunHours) / 1000;
            const actualMonthlyKwh = actualDailyKwh * 30;
            
            // Tính giá tấm pin
            const panelTotalPrice = panelCount * solarPanelPrice;
            
            // Tính dung lượng pin lưu trữ cần thiết dựa trên thời gian sử dụng
            let batteryCapacityNeeded = 0;
            let batteryRatio = 0;
            if (formData.usageTime === 'day') {
                batteryRatio = 1/3; // Dùng ban ngày nhiều: pin = 1/3 điện tạo ra
                batteryCapacityNeeded = actualDailyKwh * batteryRatio; // 1/3 điện tạo ra
            } else if (formData.usageTime === 'balanced') {
                batteryRatio = 1/2; // Dùng cả ngày đều: pin = 1/2 điện tạo ra
                batteryCapacityNeeded = actualDailyKwh * batteryRatio;
            } else if (formData.usageTime === 'night') {
                batteryRatio = 3/5; // Dùng ban đêm nhiều: pin = 3/5 điện tạo ra
                batteryCapacityNeeded = actualDailyKwh * batteryRatio;
            }
            
            // Chọn pin lưu trữ phù hợp
            const selectedBattery = batteries.find(bat => bat.capacity >= batteryCapacityNeeded) || batteries[0];
            
            // Chọn tủ điện phù hợp với biến tần
            let selectedCabinet;
            const availableCabinets = electricalCabinets[formData.phase] || [];
            
            if (availableCabinets.length > 0) {
                // Tìm tủ điện có công suất phù hợp với biến tần
                selectedCabinet = availableCabinets.find(cab => cab.power >= selectedInverter.power) || availableCabinets[availableCabinets.length - 1];
            } else {
                // Fallback nếu không có tủ điện phù hợp
                selectedCabinet = { name: "Không có tủ điện phù hợp", power: 0, price: 0, image: "../assets/img/products/electrical-cabinet.jpg" };
            }
            
            // Thêm tủ điện đã chọn vào đầu danh sách phụ kiện
            const accessoriesWithCabinet = [
                {
                    name: selectedCabinet.name,
                    unit: "cái",
                    price: selectedCabinet.price,
                    quantity: 1,
                    image: selectedCabinet.image
                },
                ...accessories
            ];
            
            // Tính phụ kiện dựa trên số tấm pin
            const calculatedAccessories = accessoriesWithCabinet.map(acc => {
                let quantity = acc.quantity;
                let displayName = acc.name;
                
                // Tính toán số lượng theo từng loại phụ kiện
                if (acc.name.includes("Bách Z")) {
                    quantity = panelCount * 6; // 6 cái/tấm
                    displayName = acc.name + " (6 cái/tấm)";
                }
                if (acc.name.includes("Kẹp Biên")) {
                    quantity = panelCount * 6; // 6 bộ/tấm
                    displayName = acc.name + " (6 bộ/tấm)";
                }
                if (acc.name.includes("MC4")) {
                    quantity = panelCount + 3; // Số tấm pin + 3
                    displayName = acc.name + " (Số tấm + 3)";
                }
                if (acc.name.includes("Dây Điện (AC/DC)")) {
                    quantity = 100; // Dự trù 100m
                    displayName = acc.name + " (Dự trù 100m, tùy công trình)";
                }
                if (acc.name.includes("Tủ Điện Hybrid")) {
                    quantity = 1; // 1 tủ/dự án
                    displayName = acc.name;
                }
                if (acc.name.includes("Công Thợ Lắp Đặt")) {
                    quantity = 1; // 1 gói lắp đặt
                    displayName = acc.name;
                }
                if (acc.name.includes("Vận Chuyển")) {
                    quantity = 1; // 1 chuyến
                    displayName = acc.name;
                }
                
                return {
                    ...acc,
                    name: displayName,
                    quantity: quantity,
                    totalPrice: quantity * acc.price
                };
            });
            
            const accessoriesTotal = calculatedAccessories.reduce((sum, acc) => sum + acc.totalPrice, 0);
            
            // Tổng cộng (đã bao gồm tất cả 12 thành phần)
            const totalPrice = panelTotalPrice + selectedInverter.price + selectedBattery.price + accessoriesTotal;
            
            // Tính tiết kiệm hàng năm (tiết kiệm 80% tiền điện)
            const annualSavings = monthlyBill * 12 * 0.8;
            const paybackPeriod = Math.ceil(totalPrice / annualSavings);
            
            // Tính tiết kiệm mỗi tháng
            const monthlySavings = monthlyBill * 0.8;
            
            return {
                monthlyKwh,
                monthlyBill,
                kwhBreakdown: kwhCalculation.breakdown, // Chi tiết phân bổ từng bậc
                systemSizeKw,
                systemSizeWatt,
                panelCount,
                solarPanelWatt,
                solarPanelPrice,
                solarPanelImage,
                panelTotalPrice,
                roofArea,
                selectedInverter,
                selectedBattery,
                batteryCapacityNeeded,
                batteryRatio,
                actualDailyKwh,
                actualMonthlyKwh,
                accessories: calculatedAccessories,
                accessoriesTotal,
                totalPrice,
                annualSavings,
                monthlySavings,
                paybackPeriod,
                dailyKwh,
                peakSunHours,
                solarPanelName: selectedOption.textContent.split(' - ')[0],
                region: formData.region,
                phase: formData.phase,
                usageTime: formData.usageTime
            };
        }

        // Xử lý form submit
        document.getElementById('surveyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Validate form
            if (!data.fullname || !data.phone || !data.region || !data.phase || 
                !data.solarPanel || !data.monthlyBill || !data.usageTime) {
                alert('Vui lòng điền đầy đủ thông tin!');
                return;
            }
            
            // Tính toán
            const result = calculateSolarSystem(data);
            
            // Hiển thị kết quả
            displayResults(result, data);
        });

        // Helper functions for accessory descriptions
        function getAccessoryDescription(name) {
            const descriptions = {
                'Tủ Điện Hybrid': 'Tủ điện điều khiển và bảo vệ hệ thống điện mặt trời, chứa các thiết bị đóng cắt, bảo vệ và giám sát',
                'Bách Z Mạ Kẽm': 'Thanh ray nhôm mạ kẽm để lắp đặt và định vị tấm pin mặt trời trên mái nhà',
                'Kẹp Biên & Kẹp Giữa': 'Phụ kiện kẹp giữ tấm pin mặt trời, đảm bảo tấm pin được cố định chắc chắn',
                'Jack Cắm MC4': 'Đầu nối MC4 chuẩn quốc tế để kết nối các tấm pin mặt trời với nhau',
                'Dây Điện (AC/DC)': 'Dây điện chuyên dụng cho hệ thống điện mặt trời, chịu được tải cao và thời tiết',
                'Công Thợ Lắp Đặt Trọn Gói': 'Dịch vụ lắp đặt hoàn chỉnh bao gồm nhân công, thiết kế, khảo sát và giám sát',
                'Vận Chuyển Đến Công Trình': 'Dịch vụ vận chuyển thiết bị từ kho đến công trình lắp đặt'
            };
            return descriptions[name] || 'Phụ kiện hỗ trợ cho hệ thống điện mặt trời';
        }
        
        function getAccessoryCalculation(name, quantity, panelCount) {
            const calculations = {
                'Tủ Điện Hybrid': '1 tủ điện cho mỗi hệ thống, được chọn phù hợp với công suất biến tần',
                'Bách Z Mạ Kẽm': `${quantity} cái = ${panelCount} tấm × 6 cái/tấm (thanh ray định vị)`,
                'Kẹp Biên & Kẹp Giữa': `${quantity} bộ = ${panelCount} tấm × 6 bộ/tấm (kẹp giữ tấm pin)`,
                'Jack Cắm MC4': `${quantity} bộ = ${panelCount} tấm + 3 bộ dự phòng (đầu vào + đầu ra + dự phòng)`,
                'Dây Điện (AC/DC)': `${quantity}m dự trù cho toàn bộ hệ thống, có thể điều chỉnh theo thực tế`,
                'Công Thợ Lắp Đặt Trọn Gói': '1 gói dịch vụ hoàn chỉnh cho toàn bộ hệ thống',
                'Vận Chuyển Đến Công Trình': '1 chuyến vận chuyển tất cả thiết bị đến công trình'
            };
            return calculations[name] || `Số lượng: ${quantity}`;
        }

        // Hiển thị kết quả
        function displayResults(result, formData) {
            const resultsDiv = document.getElementById('results');
            const placeholder = document.querySelector('.results-placeholder');
            
            // Ẩn placeholder
            placeholder.style.display = 'none';
            
            // Tạo HTML cho bảng phụ kiện chi tiết
            let accessoriesHTML = '';
            result.accessories.forEach(acc => {
                if (acc.quantity > 0) {
                    accessoriesHTML += `
                        <tr>
                            <td class="center">${acc.image.includes('../') ? 
                                `<img src="${acc.image}" alt="${acc.name}" style="width: 50px; height: 50px; object-fit: contain; border-radius: 6px; padding: 3px; background: #f7fafc;">` : 
                                `<span style="font-size: 30px; display: block; text-align: center; padding: 10px;">${acc.image}</span>`
                            }</td>
                            <td class="label-col">
                                <div style="line-height: 1.4;">
                                    <strong style="color: #2d3748; font-size: 1rem;">${acc.name}</strong><br>
                                    <div style="margin: 0.3rem 0; padding: 0.4rem; background: rgba(63,163,77,0.08); border-radius: 4px; border-left: 2px solid #3FA34D;">
                                        <small style="color: #4a5568; font-weight: 600;">📝 Mô tả:</small><br>
                                        <small style="color: #718096;">${getAccessoryDescription(acc.name)}</small>
                                    </div>
                                    <div style="margin: 0.3rem 0; padding: 0.4rem; background: rgba(255,193,7,0.08); border-radius: 4px; border-left: 2px solid #ffc107;">
                                        <small style="color: #4a5568; font-weight: 600;">🧮 Cách tính:</small><br>
                                        <small style="color: #718096;">${getAccessoryCalculation(acc.name, acc.quantity, result.panelCount)}</small>
                                    </div>
                                </div>
                            </td>
                            <td class="center">${acc.quantity} ${acc.unit}</td>
                            <td class="price-col">${acc.price.toLocaleString()}đ</td>
                            <td class="price-col">${acc.totalPrice.toLocaleString()}đ</td>
                        </tr>
                    `;
                }
            });
            
            // Tên khu vực
            const regionName = {
                'mien-bac': 'Miền Bắc',
                'mien-trung': 'Miền Trung',
                'mien-nam': 'Miền Nam'
            }[result.region] || '';
            
            // Thời gian sử dụng
            const usageTimeName = {
                'day': 'Ban ngày nhiều',
                'balanced': 'Cả ngày đều',
                'night': 'Ban đêm nhiều'
            }[result.usageTime] || '';
            
            // Hiển thị kết quả
            resultsDiv.innerHTML = `
                <div class="results-grid">
                    <div class="results-column">
                        <!-- Thông tin khách hàng & hệ thống -->
                        <div class="section-header">
                            <h3>👤 Thông Tin Khách Hàng</h3>
                        </div>
                        <table class="excel-table">
                            <tbody>
                                <tr>
                                    <td class="label-col">Họ và tên</td>
                                    <td class="value-col">${formData.fullname}</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Số điện thoại</td>
                                    <td class="value-col">${formData.phone}</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Khu vực</td>
                                    <td class="value-col">${regionName}</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Loại điện</td>
                                    <td class="value-col">${result.phase} pha</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Thời gian sử dụng điện</td>
                                    <td class="value-col">${usageTimeName}</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Phân tích nhu cầu -->
                        <div class="section-header">
                            <h3>📊 Phân Tích Nhu Cầu</h3>
                        </div>
                        
                        <!-- Bảng chi tiết tính kWh từ tiền điện -->
                        <div style="background: linear-gradient(135deg, rgba(63,163,77,0.08) 0%, rgba(168,224,99,0.08) 100%); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; border: 2px solid rgba(63,163,77,0.2);">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.8rem;">
                                <span style="font-size: 1.2rem;">⚡</span>
                                <strong style="color: #3FA34D; font-size: 0.95rem;">Chi Tiết Tính Toán Số kWh Từ Tiền Điện</strong>
                            </div>
                            <table class="excel-table" style="font-size: 0.9rem;">
                                <thead>
                                    <tr>
                                        <th>Bậc Thang</th>
                                        <th class="right">Giá/kWh</th>
                                        <th class="right">Sản Lượng (kWh)</th>
                                        <th class="right">Thành Tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${result.kwhBreakdown.map(tier => `
                                        <tr>
                                            <td class="label-col">${tier.name}</td>
                                            <td class="right">${tier.pricePerKwh.toLocaleString()}đ</td>
                                            <td class="right"><strong>${tier.kwh.toFixed(2)}</strong></td>
                                            <td class="price-col">${Math.round(tier.amount).toLocaleString()}đ</td>
                                        </tr>
                                    `).join('')}
                                    <tr style="background: rgba(63,163,77,0.15); font-weight: 700; font-size: 1.05em;">
                                        <td class="label-col">TỔNG CỘNG</td>
                                        <td></td>
                                        <td class="right" style="color: #1E5631;">${result.monthlyKwh.toFixed(1)} kWh</td>
                                        <td class="price-col" style="color: #1E5631;">${result.monthlyBill.toLocaleString()}đ</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div style="margin-top: 0.6rem; font-size: 0.8rem; color: #718096; display: flex; align-items: start; gap: 0.3rem;">
                                <span>💡</span>
                                <span>Tính toán dựa trên bảng giá điện sinh hoạt EVN áp dụng từ 10/5/2025 (đã bao gồm VAT 8%)</span>
                            </div>
                        </div>
                        
                        <!-- Tóm tắt phân tích -->
                        <table class="excel-table">
                            <tbody>
                                <tr>
                                    <td class="label-col">Hóa đơn điện/tháng</td>
                                    <td class="price-col">${result.monthlyBill.toLocaleString()}đ</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Mức tiêu thụ điện/tháng</td>
                                    <td class="value-col"><strong style="color: #3FA34D;">${result.monthlyKwh.toFixed(1)} kWh</strong></td>
                                </tr>
                                <tr>
                                    <td class="label-col">Tiêu thụ điện/ngày</td>
                                    <td class="value-col">${result.dailyKwh.toFixed(1)} kWh</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Giờ nắng trung bình (${regionName})</td>
                                    <td class="value-col">${result.peakSunHours} giờ/ngày</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Diện tích mái cần thiết</td>
                                    <td class="value-col">${result.roofArea} m²</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- BẢNG BÁO GIÁ CHI TIẾT -->
                        <div class="section-header" style="margin-top: 2rem;">
                            <h3>📋 BẢNG BÁO GIÁ CHI TIẾT HỆ THỐNG ĐIỆN MẶT TRỜI</h3>
                        </div>
                        
                        <!-- 1. Tấm pin -->
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th class="center" style="width: 80px">Ảnh</th>
                                    <th style="width: 40%">Tên thiết bị</th>
                                    <th class="center" style="width: 12%">Số lượng</th>
                                    <th class="right" style="width: 17%">Đơn giá</th>
                                    <th class="right" style="width: 17%">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background: linear-gradient(135deg, rgba(0,200,81,0.1) 0%, rgba(105,240,174,0.1) 100%); border: 2px solid rgba(0,200,81,0.3);">
                                    <td colspan="5" class="label-col" style="font-weight: 800; color: var(--color-primary); font-size: 1.1rem; padding: 1rem;">
                                        <span style="font-size: 1.3em; margin-right: 0.5rem;">⚡</span> Tấm Pin Mặt Trời
                                        <div style="font-size: 0.8rem; color: #4a5568; margin-top: 0.3rem; font-weight: 500;">Thiết bị chính tạo ra điện từ năng lượng mặt trời</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="center"><img src="${result.solarPanelImage}" alt="${result.solarPanelName}" style="width: 60px; height: 60px; object-fit: contain; border-radius: 8px; padding: 4px; background: #f7fafc;"></td>
                                    <td class="label-col">
                                        <div style="line-height: 1.4;">
                                            <strong style="color: #2d3748; font-size: 1.05rem;">${result.solarPanelName}</strong><br>
                                            <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(63,163,77,0.1); border-radius: 6px; border-left: 3px solid #3FA34D;">
                                                <small style="color: #4a5568; font-weight: 600;">📊 Thông số kỹ thuật:</small><br>
                                                <small style="color: #718096;">• Công suất: ${result.solarPanelWatt}W/tấm</small><br>
                                                <small style="color: #718096;">• Diện tích: ${result.solarPanelWatt === 590 ? '2,583m²' : '2,702m²'}/tấm</small><br>
                                                <small style="color: #718096;">• Bảo hành: 12 năm</small>
                                            </div>
                                            <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(255,193,7,0.1); border-radius: 6px; border-left: 3px solid #ffc107;">
                                                <small style="color: #4a5568; font-weight: 600;">🧮 Cách tính số tấm:</small><br>
                                                <small style="color: #718096;">• Nhu cầu: ${result.dailyKwh.toFixed(1)}kWh/ngày</small><br>
                                                <small style="color: #718096;">• Giờ nắng: ${result.peakSunHours}h/ngày</small><br>
                                                <small style="color: #718096;">• Công suất cần: ${result.dailyKwh.toFixed(1)} ÷ ${result.peakSunHours} = ${result.systemSizeKw}kWp</small><br>
                                                <small style="color: #718096;">• Số tấm: ${result.systemSizeKw}kW ÷ ${(result.solarPanelWatt/1000).toFixed(2)}kW = ${result.panelCount} tấm</small>
                                            </div>
                                            <small style="color: #3FA34D; font-weight: 600;">💰 Giá lắp đặt trọn gói</small>
                                        </div>
                                    </td>
                                    <td class="center">${result.panelCount} tấm</td>
                                    <td class="price-col">${result.solarPanelPrice.toLocaleString()}đ</td>
                                    <td class="price-col"><strong>${result.panelTotalPrice.toLocaleString()}đ</strong></td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- 2. Inverter (Biến tần) -->
                        <table class="excel-table" style="margin-top: 1rem;">
                            <tbody>
                                <tr style="background: linear-gradient(135deg, rgba(0,200,81,0.1) 0%, rgba(105,240,174,0.1) 100%); border: 2px solid rgba(0,200,81,0.3);">
                                    <td colspan="5" class="label-col" style="font-weight: 800; color: var(--color-primary); font-size: 1.1rem; padding: 1rem;">
                                        <span style="font-size: 1.3em; margin-right: 0.5rem;">🔌</span> Biến Tần (Inverter)
                                        <div style="font-size: 0.8rem; color: #4a5568; margin-top: 0.3rem; font-weight: 500;">Chuyển đổi dòng điện DC từ tấm pin thành AC cho gia đình</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="center" style="width: 80px"><img src="${result.selectedInverter.image}" alt="${result.selectedInverter.name}" style="width: 60px; height: 60px; object-fit: contain; border-radius: 8px; padding: 4px; background: #f7fafc;"></td>
                                    <td class="label-col" style="width: 40%">
                                        <div style="line-height: 1.4;">
                                            <strong style="color: #2d3748; font-size: 1.05rem;">${result.selectedInverter.name}</strong><br>
                                            <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(63,163,77,0.1); border-radius: 6px; border-left: 3px solid #3FA34D;">
                                                <small style="color: #4a5568; font-weight: 600;">📊 Thông số kỹ thuật:</small><br>
                                                <small style="color: #718096;">• Công suất: ${result.selectedInverter.power}W</small><br>
                                                <small style="color: #718096;">• Loại điện: ${result.selectedInverter.phase === '1' ? '1 Pha' : '3 Pha'}</small><br>
                                                <small style="color: #718096;">• Bảo hành: ${result.selectedInverter.warranty}</small>
                                            </div>
                                            <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(33,150,243,0.1); border-radius: 6px; border-left: 3px solid #2196f3;">
                                                <small style="color: #4a5568; font-weight: 600;">🎯 Tại sao chọn biến tần này:</small><br>
                                                <small style="color: #718096;">• Hệ thống cần: ${result.systemSizeKw}kWp</small><br>
                                                <small style="color: #718096;">• Biến tần: ${result.selectedInverter.power}W (≥ ${result.systemSizeKw}kWp)</small><br>
                                                <small style="color: #718096;">• Phù hợp với loại điện ${result.selectedInverter.phase === '1' ? '1 pha' : '3 pha'} đã chọn</small>
                                            </div>
                                            <small style="color: #3FA34D; font-weight: 600;">💰 Giá lắp đặt trọn gói</small>
                                        </div>
                                    </td>
                                    <td class="center" style="width: 12%">1 bộ</td>
                                    <td class="price-col" style="width: 17%">${result.selectedInverter.price.toLocaleString()}đ</td>
                                    <td class="price-col" style="width: 17%"><strong>${result.selectedInverter.price.toLocaleString()}đ</strong></td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- 3. Pin lưu trữ -->
                        <table class="excel-table" style="margin-top: 1rem;">
                            <tbody>
                                <tr style="background: linear-gradient(135deg, rgba(0,200,81,0.1) 0%, rgba(105,240,174,0.1) 100%); border: 2px solid rgba(0,200,81,0.3);">
                                    <td colspan="5" class="label-col" style="font-weight: 800; color: var(--color-primary); font-size: 1.1rem; padding: 1rem;">
                                        <span style="font-size: 1.3em; margin-right: 0.5rem;">🔋</span> Pin Lưu Trữ (Battery)
                                        <div style="font-size: 0.8rem; color: #4a5568; margin-top: 0.3rem; font-weight: 500;">Lưu trữ điện để sử dụng khi không có nắng</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="center" style="width: 80px"><img src="${result.selectedBattery.image}" alt="${result.selectedBattery.name}" style="width: 60px; height: 60px; object-fit: contain; border-radius: 8px; padding: 4px; background: #f7fafc;"></td>
                                    <td class="label-col" style="width: 40%">
                                        <div style="line-height: 1.4;">
                                            <strong style="color: #2d3748; font-size: 1.05rem;">${result.selectedBattery.name}</strong><br>
                                            <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(63,163,77,0.1); border-radius: 6px; border-left: 3px solid #3FA34D;">
                                                <small style="color: #4a5568; font-weight: 600;">📊 Thông số kỹ thuật:</small><br>
                                                <small style="color: #718096;">• Dung lượng: ${result.selectedBattery.capacity} kWh</small><br>
                                                <small style="color: #718096;">• Bảo hành: ${result.selectedBattery.warranty}</small>
                                            </div>
                                            <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(156,39,176,0.1); border-radius: 6px; border-left: 3px solid #9c27b0;">
                                                <small style="color: #4a5568; font-weight: 600;">🧮 Cách tính dung lượng pin:</small><br>
                                                <small style="color: #718096;">• Điện tạo ra: ${result.actualDailyKwh.toFixed(1)}kWh/ngày</small><br>
                                                <small style="color: #718096;">• Thời gian dùng: ${usageTimeName}</small><br>
                                                <small style="color: #718096;">• Tỷ lệ pin: ${(result.batteryRatio * 100).toFixed(0)}% điện tạo ra</small><br>
                                                <small style="color: #718096;">• Pin cần: ${result.actualDailyKwh.toFixed(1)} × ${result.batteryRatio} = ${result.batteryCapacityNeeded.toFixed(2)}kWh</small><br>
                                                <small style="color: #718096;">• Chọn pin: ${result.selectedBattery.capacity}kWh (≥ ${result.batteryCapacityNeeded.toFixed(2)}kWh)</small>
                                            </div>
                                            <small style="color: #3FA34D; font-weight: 600;">💰 Giá lắp đặt trọn gói</small>
                                        </div>
                                    </td>
                                    <td class="center" style="width: 12%">1 bộ</td>
                                    <td class="price-col" style="width: 17%">${result.selectedBattery.price.toLocaleString()}đ</td>
                                    <td class="price-col" style="width: 17%"><strong>${result.selectedBattery.price.toLocaleString()}đ</strong></td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- 4. Phụ kiện & Vật tư lắp đặt -->
                        <table class="excel-table" style="margin-top: 1rem;">
                            <tbody>
                                <tr style="background: linear-gradient(135deg, rgba(0,200,81,0.1) 0%, rgba(105,240,174,0.1) 100%); border: 2px solid rgba(0,200,81,0.3);">
                                    <td colspan="5" class="label-col" style="font-weight: 800; color: var(--color-primary); font-size: 1.1rem; padding: 1rem;">
                                        <span style="font-size: 1.3em; margin-right: 0.5rem;">🔧</span> Phụ Kiện & Vật Tư Lắp Đặt
                                        <div style="font-size: 0.8rem; color: #4a5568; margin-top: 0.3rem; font-weight: 500;">Các thiết bị phụ trợ và dịch vụ lắp đặt hoàn chỉnh</div>
                                    </td>
                                </tr>
                                ${accessoriesHTML}
                                <tr style="background: rgba(168,224,99,0.1); font-weight: 600;">
                                    <td class="label-col" colspan="4">Tổng phụ kiện</td>
                                    <td class="price-col"><strong>${result.accessoriesTotal.toLocaleString()}đ</strong></td>
                                </tr>
                            </tbody>
                        </table>


                        <!-- Tổng cộng -->
                        <div class="section-header" style="margin-top: 2rem;">
                            <h3>💰 Tổng Kết Chi Phí</h3>
                        </div>
                        <table class="excel-table">
                            <tbody>
                                <tr>
                                    <td class="label-col">Tổng thiết bị</td>
                                    <td class="price-col">${(result.totalPrice - result.accessoriesTotal).toLocaleString()}đ</td>
                                </tr>
                                <tr>
                                    <td class="label-col">Phụ kiện & lắp đặt</td>
                                    <td class="price-col">${result.accessoriesTotal.toLocaleString()}đ</td>
                                </tr>
                                <tr style="background: linear-gradient(135deg, rgba(63,163,77,0.15) 0%, rgba(168,224,99,0.15) 100%); font-weight: 700; font-size: 1.1em;">
                                    <td class="label-col" style="color: #1E5631;">TỔNG CHI PHÍ ĐẦU TƯ</td>
                                    <td class="price-col" style="color: #1E5631; font-size: 1.2em;">${result.totalPrice.toLocaleString()}đ</td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>

                <!-- Tổng kết nổi bật -->
                <div class="total-summary">
                    <div class="summary-header">
                        <div class="summary-icon">🎯</div>
                        <h3>TỔNG QUAN HỆ THỐNG</h3>
                    </div>
                    
                    <div class="total-price-section">
                        <div class="price-label">Tổng đầu tư</div>
                        <div class="total-price">${result.totalPrice.toLocaleString()}đ</div>
                    </div>
                    
                    <div class="summary-grid">
                        <div class="summary-card">
                            <div class="card-icon">⚡</div>
                            <div class="card-content">
                                <div class="card-label">Hệ thống</div>
                                <div class="card-value">${result.systemSizeKw} kWp</div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="card-icon">📦</div>
                            <div class="card-content">
                                <div class="card-label">Tấm pin</div>
                                <div class="card-value">${result.panelCount} tấm</div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="card-icon">🔌</div>
                            <div class="card-content">
                                <div class="card-label">Inverter</div>
                                <div class="card-value">LUXPOWER 6K</div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="card-icon">🔋</div>
                            <div class="card-content">
                                <div class="card-label">Pin lưu trữ</div>
                                <div class="card-value">${result.selectedBattery.capacity} kWh</div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="card-icon">💰</div>
                            <div class="card-content">
                                <div class="card-label">Tiết kiệm/năm</div>
                                <div class="card-value">${(result.annualSavings/1000000).toFixed(1)}M đ</div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="card-icon">⏱️</div>
                            <div class="card-content">
                                <div class="card-label">Hoàn vốn</div>
                                <div class="card-value">${result.paybackPeriod} năm</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="summary-notes">
                        <div class="note-item">Giá thiết bị là giá lắp đặt trọn gói (đã bao gồm VAT)</div>
                        <div class="note-item">Tính toán dựa trên bảng giá điện EVN áp dụng từ 10/5/2025</div>
                        <div class="note-item">Bảo hành tấm pin 12 năm, hiệu suất sau 25-30 năm ≥ 80%</div>
                    </div>
                </div>

                <!-- Nút lưu báo giá -->
                <div style="text-align: center; margin-top: 2rem;">
                    <button id="saveSurveyBtn" style="background: linear-gradient(135deg, #56ab2f 0%, #3FA34D 100%); color: white; border: none; padding: 1rem 2rem; border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; box-shadow: 0 6px 20px rgba(63,163,77,0.4); transition: all 0.3s;">
                        💾 Lưu Báo Giá
                    </button>
                </div>
            `;
            
            // Hiển thị kết quả với animation
            resultsDiv.classList.add('show');
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Add event listener to save button (after it's created)
            const saveSurveyBtn = document.getElementById('saveSurveyBtn');
            if (saveSurveyBtn) {
                console.log('Save button found after creation, adding event listener');
                saveSurveyBtn.addEventListener('click', function(e) {
                    console.log('Save button clicked!', e);
                    saveSurvey();
                });
            } else {
                console.error('Save button still not found after creation!');
            }
        }

        // Format currency input
        document.getElementById('monthlyBillInput').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^\d]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString('vi-VN');
                e.target.value = value;
            }
        });

        // Enhanced page animations and effects
        document.addEventListener('DOMContentLoaded', function() {
            // Add floating elements
            createFloatingElements();
            
            // Add scroll animations
            addScrollAnimations();
            
            // Add form interaction effects
            addFormEffects();
        });

        function createFloatingElements() {
            const symbols = ['☀️', '⚡', '🔋', '🔌', '🌱', '💚'];
            const container = document.body;
            
            for (let i = 0; i < 6; i++) {
                const element = document.createElement('div');
                element.innerHTML = symbols[i];
                element.style.cssText = `
                    position: fixed;
                    font-size: ${Math.random() * 1 + 1.5}rem;
                    color: rgba(0, 200, 81, 0.2);
                    pointer-events: none;
                    z-index: 0;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: floatRandom ${8 + Math.random() * 4}s ease-in-out infinite;
                    animation-delay: ${Math.random() * 2}s;
                `;
                container.appendChild(element);
            }
            
            // Add CSS for random floating animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes floatRandom {
                    0%, 100% { 
                        transform: translateY(0px) rotate(0deg) scale(1); 
                        opacity: 0.2; 
                    }
                    25% { 
                        transform: translateY(-30px) rotate(90deg) scale(1.1); 
                        opacity: 0.4; 
                    }
                    50% { 
                        transform: translateY(-60px) rotate(180deg) scale(0.9); 
                        opacity: 0.3; 
                    }
                    75% { 
                        transform: translateY(-30px) rotate(270deg) scale(1.05); 
                        opacity: 0.5; 
                    }
                }
            `;
            document.head.appendChild(style);
        }

        function addScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'fadeInUp 0.8s ease-out forwards';
                    }
                });
            }, { threshold: 0.1 });

            // Observe all form groups and sections
            document.querySelectorAll('.form-group, .section-header, .excel-table').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';
                observer.observe(el);
            });
            
            // Add fadeInUp animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInUp {
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
            `;
            document.head.appendChild(style);
        }

        function addFormEffects() {
            // Add ripple effect to buttons
            document.addEventListener('click', function(e) {
                if (e.target.matches('.btn-calculate, .radio-option')) {
                    const ripple = document.createElement('span');
                    const rect = e.target.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.cssText = `
                        position: absolute;
                        width: ${size}px;
                        height: ${size}px;
                        left: ${x}px;
                        top: ${y}px;
                        background: rgba(255,255,255,0.6);
                        border-radius: 50%;
                        transform: scale(0);
                        animation: ripple 0.6s linear;
                        pointer-events: none;
                    `;
                    
                    e.target.style.position = 'relative';
                    e.target.style.overflow = 'hidden';
                    e.target.appendChild(ripple);
                    
                    setTimeout(() => ripple.remove(), 600);
                }
            });
            
            // Add ripple animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    </script>

    <!-- Slideshow Scripts -->
    <script>
        // Set path prefix for pages in html/ directory
        window.SLIDESHOW_PATH_PREFIX = '../';
    </script>
    <script src="../assets/js/slideshow-config.js"></script>
    <script src="../assets/js/slideshow.js"></script>
    <script src="../assets/js/cache-buster.js"></script>

    <!-- Survey Save Logic -->
    <script>
        // Debug: Check if button exists
        console.log('Survey save script loaded');
        
        // Note: Event listener will be added when button is created dynamically
        // No need to add it on DOMContentLoaded since button doesn't exist yet

        async function saveSurvey() {
            console.log('saveSurvey function called');
            let originalText = '💾 Lưu Báo Giá'; // Default text
            
            try {
                // Show loading state
                const saveBtn = document.getElementById('saveSurveyBtn');
                console.log('Save button element:', saveBtn);
                
                if (!saveBtn) {
                    console.error('Save button not found in saveSurvey function');
                    return;
                }
                
                originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '⏳ Đang lưu...';
                saveBtn.disabled = true;

                // Collect survey data from form
                const surveyData = collectSurveyData();
                console.log('Survey data collected:', surveyData);
                
                // Collect calculation results
                const results = collectCalculationResults();
                console.log('Calculation results collected:', results);
                
                // Prepare data for API
                const apiData = {
                    ...surveyData,
                    results: results
                };

                console.log('Saving survey data:', apiData);

                // Call API to save survey
                const response = await fetch('../api/save_survey.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(apiData)
                });

                console.log('API response:', response);
                const result = await response.json();
                console.log('API result:', result);

                if (result.success) {
                    // Show success message
                    showNotification('✅ Đã lưu báo giá thành công!', 'success');
                    
                    // Optional: Redirect to survey history
                    setTimeout(() => {
                        window.location.href = 'survey_history.html';
                    }, 2000);
                } else {
                    showNotification('❌ Lỗi: ' + result.message, 'error');
                }

            } catch (error) {
                console.error('Error saving survey:', error);
                showNotification('❌ Lỗi kết nối server', 'error');
            } finally {
                // Restore button state
                const saveBtn = document.getElementById('saveSurveyBtn');
                if (saveBtn) {
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                }
            }
        }

        function collectSurveyData() {
            // Get form values
            const region = document.querySelector('select[name="region"]')?.value || '';
            const phase = document.querySelector('input[name="phase"]:checked')?.value || '';
            const solarPanel = document.querySelector('select[name="solarPanel"]')?.value || '';
            const monthlyBill = document.getElementById('monthlyBillInput')?.value || '';
            const usageTime = document.querySelector('select[name="usageTime"]')?.value || '';

            console.log('Form values collected:', {
                region, phase, solarPanel, monthlyBill, usageTime
            });

            return {
                region: region,
                phase: parseInt(phase),
                solarPanel: parseInt(solarPanel),
                monthlyBill: parseFloat(monthlyBill.replace(/[^\d]/g, '')), // Remove formatting
                usageTime: usageTime
            };
        }

        function collectCalculationResults() {
            // Try to get results from global variables or DOM
            if (typeof window.surveyResults !== 'undefined') {
                return window.surveyResults;
            }

            // Fallback: try to reconstruct from DOM
            const results = {};
            
            // Get values from result display elements
            const monthlyKWhEl = document.querySelector('[data-result="monthlyKWh"]');
            const panelsNeededEl = document.querySelector('[data-result="panelsNeeded"]');
            const totalCostEl = document.querySelector('[data-result="totalCost"]');
            
            if (monthlyKWhEl) results.monthlyKWh = parseFloat(monthlyKWhEl.textContent);
            if (panelsNeededEl) results.panelsNeeded = parseInt(panelsNeededEl.textContent);
            if (totalCostEl) results.totalCost = parseFloat(totalCostEl.textContent.replace(/[^\d.]/g, ''));

            // Get solar panel info from form
            const solarPanelSelect = document.querySelector('select[name="solarPanel"]');
            const solarPanelValue = solarPanelSelect?.value || '590';
            
            // Map solar panel values to panel info
            const panelInfoMap = {
                '590': { id: 1, name: 'Pin mặt trời 590W', power: 590, price: 2500000 },
                '630': { id: 2, name: 'Pin mặt trời 630W', power: 630, price: 2800000 }
            };
            
            const panelInfo = panelInfoMap[solarPanelValue] || panelInfoMap['590'];

            console.log('Calculation results collected:', {
                monthlyKWh: results.monthlyKWh || 0,
                panelsNeeded: results.panelsNeeded || 0,
                totalCost: results.totalCost || 0,
                panelInfo: panelInfo
            });

            // Add default values if not found
            return {
                monthlyKWh: results.monthlyKWh || 0,
                sunHours: 5.5, // Default sun hours
                panelsNeeded: results.panelsNeeded || 0,
                panelCost: (results.panelsNeeded || 0) * panelInfo.price,
                panelInfo: panelInfo,
                energyPerPanelPerDay: panelInfo.power * 5.5, // sunHours
                totalCapacity: (results.panelsNeeded || 0) * panelInfo.power,
                inverter: { id: 1, name: 'Inverter Luxpower', capacity: 6000, price: 15000000 },
                cabinet: { id: 1, name: 'Tủ điện', capacity: 6000, price: 2000000 },
                batteryNeeded: 0,
                totalCost: results.totalCost || 0,
                batteryOptions: [
                    { id: 1, name: 'Pin lưu trữ 8 cell', capacity: 8.3, quantity: 0, price: 15000000, totalCost: 0 },
                    { id: 2, name: 'Pin lưu trữ 16 cell', capacity: 16.6, quantity: 0, price: 25000000, totalCost: 0 }
                ],
                accessories: {
                    bachZ: { qty: 0, price: 0, cost: 0 },
                    clip: { qty: 0, price: 0, cost: 0 },
                    jackMC4: { qty: 0, price: 0, cost: 0 }
                },
                dcCable: { length: 0, price: 0, cost: 0 },
                accessoriesCost: 0,
                laborCost: 0,
                billBreakdown: []
            };
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;

            // Add to page
            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
    </script>
</body>
</html>

