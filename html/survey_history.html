<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Sử Khảo Sát - HC Eco System</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/header.css">
    <link rel="stylesheet" href="../assets/css/footer.css">
    <style>
        body {
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
            position: relative;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .history-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .history-header {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .history-header h1 {
            color: #2d3748;
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
        }
        
        .history-header p {
            color: #718096;
            margin: 0;
        }
        
        .survey-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .survey-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .survey-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .survey-summary {
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .survey-info {
            flex: 1;
        }
        
        .survey-date {
            font-size: 0.9rem;
            color: #a0aec0;
            margin-bottom: 0.5rem;
        }
        
        .survey-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }
        
        .survey-meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        .survey-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #4a5568;
        }
        
        .survey-price {
            font-size: 1.5rem;
            font-weight: 800;
            color: #3FA34D;
            text-align: right;
        }
        
        .expand-icon {
            font-size: 1.5rem;
            color: #cbd5e0;
            transition: transform 0.3s;
        }
        
        .survey-card.expanded .expand-icon {
            transform: rotate(180deg);
        }
        
        .survey-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .survey-card.expanded .survey-details {
            max-height: 2000px;
        }
        
        .survey-details-content {
            padding: 0 1.5rem 1.5rem;
            border-top: 2px solid #f7fafc;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .detail-item {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 10px;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 0.3rem;
        }
        
        .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
        }
        
        .empty-state {
            background: white;
            padding: 4rem 2rem;
            border-radius: 15px;
            text-align: center;
        }
        
        .empty-icon {
            font-size: 4rem;
            color: #cbd5e0;
            margin-bottom: 1rem;
        }
        
        .empty-text {
            color: #718096;
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }
        
        .btn-primary {
            display: inline-block;
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(86, 171, 47, 0.3);
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: white;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <header class="topbar">
        <div class="container topbar-container">
            <a href="../index.html" class="brand">
                <img src="../assets/img/logo.jpg" alt="Logo" class="logo" />
                <div class="brand-text">
                    <div class="brand-name">HC<span>ECO SYSTEM</span></div>
                    <p>Giải pháp bền vững cho năng lượng tương lai</p>
                </div>
            </a>
            <div class="topbar-actions">
                <nav class="nav">
                    <div class="nav-item nav-item--dropdown">
                        <a href="pricing.html" class="nav-link">Bảng giá sản phẩm</a>
                        <div class="nav-dropdown" role="menu">
                            <a href="product-solar-panels.html">Tấm pin Jinko Solar</a>
                            <a href="product-luxpower-hybrid.html">Inverter LuxPower Hybrid</a>
                            <a href="product-luxpower-1pha.html">LuxPower Hybrid 1 Pha</a>
                            <a href="product-luxpower-3phase.html">LuxPower Hybrid 3 Pha</a>
                            <a href="product-luxpower-3phase-high.html">LuxPower 3 Pha Áp Cao</a>
                            <a href="product-growatt-110kw.html">Growatt MAX 110kW</a>
                            <a href="product-battery-storage.html">Pin lưu trữ A-Cornex</a>
                            <a href="product-battery-byd.html">Pin lưu trữ BYD</a>
                            <a href="product-electrical-cabinet.html">Tủ điện Hybrid</a>
                            <a href="product-cables.html">Phụ kiện &amp; Cáp</a>
                        </div>
                    </div>
                    <a href="../index.html#solutions" class="nav-link">Giải pháp</a>
                    <a href="../index.html#process" class="nav-link">Quy trình</a>
                    <a href="https://c-homebuild.com/" target="_blank" rel="noopener" class="nav-link">Xây dựng</a>
                    <a href="tin-tuc.html" class="nav-link">Tin tức</a>
                    <a href="#site-footer" class="nav-link">Liên hệ</a>
                </nav>
                <a class="cta" href="khao-sat-dien-mat-troi.html">Nhận tư vấn</a>
            </div>
        </div>
    </header>

    <div class="auth-floating" id="auth-floating">
        <div class="auth-buttons" id="auth-buttons">
            <a class="auth-btn auth-btn--login" href="login.html">Đăng nhập</a>
            <a class="auth-btn auth-btn--register" href="register.html">Đăng ký</a>
        </div>
    </div>

    <aside class="quick-contact" aria-label="Liên hệ nhanh">
        <a class="contact-item contact-item--fanpage" href="https://www.facebook.com/hc.ecosystem" target="_blank" rel="noopener">
            <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M15.6 3H18V0h-2.6C11.8 0 10 2.1 10 5.2V8H7v3h3v9h3v-9h3l.5-3H13V5.4c0-1.2.4-2.4 2.6-2.4z" fill="currentColor" />
                </svg>
            </span>
            <span class="label">
                <strong>Fanpage</strong>
                <span>HC Ecosystem</span>
            </span>
        </a>
        <a class="contact-item contact-item--messenger" href="https://m.me/hc.ecosystem" target="_blank" rel="noopener">
            <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M12 2C6.5 2 2 6.14 2 11.25c0 2.93 1.4 5.52 3.6 7.26V23l4.4-2.42c1.17.32 2.42.5 3.7.5 5.5 0 10-4.14 10-9.25S17.5 2 12 2zm1 12.5l-2.5-2.67-4.9 2.67 5.4-5.73 2.56 2.67 4.84-2.67-5.4 5.73z" fill="currentColor" />
                </svg>
            </span>
            <span class="label">
                <strong>Messenger</strong>
                <span>Chat ngay</span>
            </span>
        </a>
        <a class="contact-item contact-item--phone" href="tel:0977247393">
            <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M6.62 10.79a15.15 15.15 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.27 11.36 11.36 0 003.57.57 1 1 0 011 1v3.5a1 1 0 01-1 1A17 17 0 013 4a1 1 0 011-1h3.5a1 1 0 011 1 11.36 11.36 0 00.57 3.57 1 1 0 01-.27 1.11z" fill="currentColor" />
                </svg>
            </span>
            <span class="label">
                <strong>Hotline</strong>
                <span>0977 247 393</span>
            </span>
        </a>
        <a class="contact-item contact-item--zalo" href="https://zalo.me/0977247393" target="_blank" rel="noopener">
            <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm3.5 14h-7a.5.5 0 010-1h7a.5.5 0 010 1zm0-3h-7a.5.5 0 010-1h7a.5.5 0 010 1zm0-3h-7a.5.5 0 010-1h7a.5.5 0 010 1z" fill="currentColor" />
                </svg>
            </span>
            <span class="label">
                <strong>Zalo</strong>
                <span>0977 247 393</span>
            </span>
        </a>
        <a class="contact-item contact-item--tiktok" href="https://www.tiktok.com/@hcecosystem" target="_blank" rel="noopener">
            <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M16.5 2h3a4.5 4.5 0 004.5 4.5v3a7.5 7.5 0 01-4.5-1.5V17a6.5 6.5 0 11-6.5-6.5v3a3.5 3.5 0 103.5 3.5V2z" fill="currentColor" />
                </svg>
            </span>
            <span class="label">
                <strong>TikTok</strong>
                <span>@hcecosystem</span>
            </span>
        </a>
        <a class="contact-item contact-item--youtube" href="https://www.youtube.com/@hcecosystem" target="_blank" rel="noopener">
            <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M23.5 6.5a3 3 0 00-2.1-2.1C19.5 4 12 4 12 4s-7.5 0-9.4.4A3 3 0 00.5 6.5 31 31 0 000 12a31 31 0 00.5 5.5 3 3 0 002.1 2.1c1.9.4 9.4.4 9.4.4s7.5 0 9.4-.4a3 3 0 002.1-2.1A31 31 0 0024 12a31 31 0 00-.5-5.5zM9.5 15.5v-7l6.3 3.5-6.3 3.5z" fill="currentColor" />
                </svg>
            </span>
            <span class="label">
                <strong>YouTube</strong>
                <span>HC Ecosystem</span>
            </span>
        </a>
        <a class="contact-item contact-item--maps" href="https://www.google.com/maps/search/?api=1&query=790+Ng%C3%B4+Quy%E1%BB%81n,+Ph%C6%B0%E1%BB%9Dng+An+H%E1%BA%A3i,+Th%C3%A0nh+Ph%E1%BB%91+%C4%90%C3%A0+N%E1%BA%B5ng" target="_blank" rel="noopener">
            <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img" focusable="false">
                    <path d="M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z" fill="currentColor" />
                </svg>
            </span>
            <span class="label">
                <strong>Văn phòng</strong>
                <span>790 Ngô Quyền, Đà Nẵng</span>
            </span>
        </a>
    </aside>

    <main>
        <div class="history-container">
            <div class="history-header">
                <h1>📋 Lịch Sử Khảo Sát</h1>
                <p>Xem lại các báo giá điện mặt trời bạn đã tính toán</p>
            </div>

            <div id="loading" class="loading">
                ⏳ Đang tải dữ liệu...
            </div>

            <div id="surveyList" class="survey-list" style="display: none;">
                <!-- Surveys will be loaded here -->
            </div>

            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-icon">📭</div>
                <p class="empty-text">Bạn chưa có khảo sát nào</p>
                <a href="khao-sat-dien-mat-troi.html" class="btn-primary">Tạo khảo sát mới</a>
            </div>
        </div>
    </main>

    <!-- Floating Action Button for Cart -->
    <a href="gio-hang.html" class="cart-fab" id="cart-fab">
        🛒
        <span class="cart-badge" id="cart-badge">0</span>
    </a>

    <footer id="site-footer" class="footer">
        <div class="container footer-layout">
            <div class="footer-left">
                <a href="../index.html" class="footer-branding">
                    <img class="footer-logo" src="../assets/img/logo.jpg" alt="Logo HC Eco System" />
                    <div class="footer-brand-copy">
                        <div class="footer-brand-name">HC<span>ECO SYSTEM</span></div>
                        <p>Giải pháp bền vững cho năng lượng tương lai</p>
                    </div>
                </a>
                <ul class="footer-company-info">
                    <li><strong>Công ty TNHH HC Ecosystem</strong></li>
                    <li><strong>Mã số thuế:</strong> 0123456789</li>
                    <li><strong>Địa chỉ Văn phòng:</strong><br>790 Ngô Quyền, Phường An Hải, Thành Phố Đà Nẵng</li>
                </ul>
            </div>
            <div class="footer-right">
                <h4>Chính sách &amp; Dịch vụ</h4>
                <ul class="policy-links">
                    <li><a href="tam-nhin-su-menh.html">Tầm Nhìn &amp; Sứ Mệnh</a></li>
                    <li><a href="dieu-khoan-dieu-kien.html">Điều Khoản &amp; Điều Kiện</a></li>
                    <li><a href="chinh-sach-doi-tra.html">Chính Sách Đổi Trả</a></li>
                    <li><a href="chinh-sach-bao-mat-thong-tin-ca-nhan.html">Chính Sách Bảo Mật Thông Tin Cá Nhân</a></li>
                    <li><a href="chinh-sach-bao-mat-thong-tin-thanh-toan.html">Chính Sách Bảo Mật Thông Tin Thanh Toán</a></li>
                    <li><a href="chinh-sach-bao-hanh.html">Chính Sách Bảo Hành</a></li>
                    <li><a href="tro-thanh-nha-phan-phoi.html">Trở Thành Nhà Phân Phối</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/shopping-cart.js"></script>
    <script>
        // Format giá tiền
        function formatPrice(price) {
            if (!price) return '0đ';
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") + 'đ';
        }

        // Format ngày tháng
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        // Tên region
        function getRegionName(region) {
            const names = {
                'mien-bac': 'Miền Bắc',
                'mien-trung': 'Miền Trung',
                'mien-nam': 'Miền Nam'
            };
            return names[region] || region;
        }

        // Load lịch sử khảo sát
        async function loadSurveyHistory() {
            try {
                const response = await fetch('../api/get_survey_history.php');
                const data = await response.json();

                document.getElementById('loading').style.display = 'none';

                if (data.success && data.surveys && data.surveys.length > 0) {
                    displaySurveys(data.surveys);
                } else {
                    document.getElementById('emptyState').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading history:', error);
                document.getElementById('loading').innerHTML = '<p style="color: #ff6b6b;">❌ Lỗi khi tải dữ liệu</p>';
            }
        }

        // Hiển thị danh sách khảo sát
        function displaySurveys(surveys) {
            const listEl = document.getElementById('surveyList');
            listEl.style.display = 'flex';

            listEl.innerHTML = surveys.map((survey, index) => `
                <div class="survey-card" data-index="${index}">
                    <div class="survey-summary" onclick="toggleSurvey(${index})">
                        <div class="survey-info">
                            <div class="survey-date">📅 ${formatDate(survey.createdAt)}</div>
                            <div class="survey-title">Báo giá hệ thống ${survey.phase} pha - ${getRegionName(survey.region)}</div>
                            <div class="survey-meta">
                                <div class="survey-meta-item">
                                    <span>⚡</span>
                                    <span>Hóa đơn: ${formatPrice(survey.monthlyBill)}/tháng</span>
                                </div>
                                <div class="survey-meta-item">
                                    <span>☀️</span>
                                    <span>Panel ${survey.solarPanelType}W</span>
                                </div>
                                ${survey.results ? `
                                <div class="survey-meta-item">
                                    <span>🔋</span>
                                    <span>${survey.results.panelsNeeded} tấm pin</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                            ${survey.results ? `<div class="survey-price">${formatPrice(survey.results.totalCost)}</div>` : '<div style="color: #a0aec0;">Chưa có kết quả</div>'}
                            <div class="expand-icon">▼</div>
                        </div>
                    </div>
                    <div class="survey-details">
                        <div class="survey-details-content">
                            ${survey.results ? `
                            <div class="details-grid">
                                <div class="detail-item">
                                    <div class="detail-label">Điện năng hàng tháng</div>
                                    <div class="detail-value">${survey.results.monthlyKWh} kWh</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Số lượng tấm pin</div>
                                    <div class="detail-value">${survey.results.panelsNeeded} tấm</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Inverter</div>
                                    <div class="detail-value">${survey.results.inverterName || 'N/A'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Pin lưu trữ</div>
                                    <div class="detail-value">${survey.results.batteryType === '8cell' ? 'BYD 8 Cell' : 'A-Cornex 16 Cell'} x${survey.results.batteryQuantity || 0}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Tổng chi phí</div>
                                    <div class="detail-value" style="color: #3FA34D; font-size: 1.3rem;">${formatPrice(survey.results.totalCost)}</div>
                                </div>
                            </div>
                            ` : '<p style="color: #a0aec0; text-align: center; padding: 2rem;">Khảo sát chưa có kết quả tính toán</p>'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toggle mở/đóng chi tiết
        function toggleSurvey(index) {
            const card = document.querySelector(`.survey-card[data-index="${index}"]`);
            card.classList.toggle('expanded');
        }

        // Load dữ liệu khi trang load
        window.addEventListener('DOMContentLoaded', loadSurveyHistory);
    </script>
</body>
</html>
